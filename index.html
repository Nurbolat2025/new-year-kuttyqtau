<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global 2026 Greeting</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d47a1">
    <link rel="icon" type="image/png" href="icon-192.png">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        body {
            margin: 0; padding: 0;
            min-height: 100vh;
            color: white;
            text-align: center;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        /* --- –ö–ê–†–¢–ê --- */
        #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
        .overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 15, 30, 0.8); 
            z-index: 1; pointer-events: none; 
        }

        /* --- –ñ–û“í–ê–†“í–´ –ú”ò–ó–Ü–† --- */
        .top-controls {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            display: flex; gap: 10px; flex-wrap: wrap; justify-content: flex-end;
        }
        .icon-btn {
            background: rgba(0,0,0,0.5); color: white;
            border: 1px solid rgba(255,255,255,0.3); border-radius: 50%;
            width: 45px; height: 45px; font-size: 20px; cursor: pointer;
            backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center;
        }
        .lang-select {
            background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 5px 15px;
            font-weight: bold; border: none; cursor: pointer; outline: none;
        }

        /* --- –û–†–¢–ê“¢“í–´ –ö–ê–†–¢–û–ß–ö–ê --- */
        .card {
            position: relative; z-index: 100;
            background: rgba(0, 0, 0, 0.65);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            padding: 25px; border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 15px 50px rgba(0,0,0,0.8);
            width: 90%; max-width: 420px;
            transition: transform 0.3s ease;
            margin-bottom: 20px;
        }

        h1 { color: #FFD700; text-shadow: 0 0 15px #FF8C00; font-size: 1.8rem; margin: 10px 0; }

        .countdown-box {
            font-family: 'Courier New', monospace;
            background: rgba(0, 255, 255, 0.1); color: #84ffff;
            padding: 10px; border-radius: 12px; margin: 15px 0;
            font-size: 1.1rem; border: 1px solid rgba(132, 255, 255, 0.3);
            text-shadow: 0 0 5px #84ffff;
        }

        .chest-wrapper { margin: 30px 0; cursor: pointer; animation: float 3s ease-in-out infinite; }
        .chest-icon { font-size: 80px; filter: drop-shadow(0 0 20px gold); }
        .chest-hint { font-size: 0.9rem; color: #aaa; margin-top: 10px; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .city-name { font-size: 2rem; color: #4DD0E1; margin: 5px 0; text-shadow: 2px 2px 4px black; }
        .greeting-text { font-size: 1.1rem; line-height: 1.5; color: #eee; margin: 15px 0; }
        
        .poem-box {
            background: rgba(0, 40, 0, 0.4);
            padding: 15px; border-radius: 15px;
            margin: 15px 0; border-left: 4px solid #FFD700;
            font-style: italic; white-space: pre-line;
            color: #fffde7; font-size: 1rem; line-height: 1.6;
            text-shadow: 1px 1px 2px black;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        input { width: 85%; padding: 12px; margin: 10px 0; border-radius: 12px; border: none; text-align: center; font-size: 16px; }
        .main-btn {
            width: 100%; padding: 14px; margin: 5px 0;
            border-radius: 12px; border: none; font-size: 16px; font-weight: bold;
            background: linear-gradient(135deg, #FFD700 0%, #FFA000 100%);
            color: #000; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        .main-btn:active { transform: scale(0.98); }
        .share-btn { background: linear-gradient(135deg, #eee 0%, #ccc 100%); color: #333; }
        .download-btn { background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); color: white; }
        .confirm-btn { background: #4CAF50; color: white; margin-right: 5px; width: 45%; }
        .deny-btn { background: #F44336; color: white; width: 45%; }

        .hidden { display: none !important; }
        .plane-icon { font-size: 30px; text-shadow: 0 0 10px black; }

        /* “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞ */
        #errorMsg { color: #FF5252; font-size: 0.9rem; margin-top: 5px; display: none; background: rgba(0,0,0,0.5); padding: 5px; border-radius: 5px; }

        #stats-container {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            z-index: 1000; opacity: 0.8; transition: opacity 0.3s;
        }
        #stats-container:hover { opacity: 1; }
        #stats-container img { border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); }
    </style>
</head>
<body>

    <div id="map"></div>
    <div class="overlay"></div>

    <audio id="bgMusic" loop preload="auto">
        <source src="https://cdn.pixabay.com/download/audio/2022/10/25/audio_1f23348651.mp3" type="audio/mp3">
    </audio>

    <div class="top-controls">
        <button id="musicBtn" class="icon-btn" onclick="toggleMusic()">üîá</button>
        <select id="uiLangSelect" class="lang-select" onchange="changeLanguage()">
            <option value="kk">üá∞üáø “ö–ê–ó</option>
            <option value="ru">üá∑üá∫ –†–£–°</option>
            <option value="en">üá∫üá∏ ENG</option>
            <option value="zh">üá®üá≥ CHN</option>
            <option value="es">üá™üá∏ ESP</option>
            <option value="fr">üá´üá∑ FRA</option>
            <option value="hi">üáÆüá≥ HIN</option>
            <option value="tr">üáπüá∑ TUR</option>
            <option value="ar">üá¶üá™ ARA</option>
        </select>
    </div>

    <div id="loginScreen" class="card">
        <h1>üåô –ë–µ—Ä–µ–∫–µ–ª—ñ 2026</h1>
        <div id="loginCountdown" class="countdown-box">–ñ“Ø–∫—Ç–µ–ª—É–¥–µ...</div>
        <p id="appDesc">–ê–¥–∞–ª –Ω–∏–µ—Ç–ø–µ–Ω “õ“±—Ç—Ç—ã“õ—Ç–∞—É –∂–æ–ª–¥–∞“£—ã–∑!</p>
        
        <div id="confirmNameBlock" class="hidden" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px;">
            <p id="confirmQuestion" style="font-size: 1.1rem; margin-bottom: 10px;">–°—ñ–∑–¥—ñ“£ –∞—Ç—ã“£—ã–∑ <b id="detectedName" style="color: #FFD700;"></b> –±–∞?</p>
            <div style="display: flex; justify-content: space-around;">
                <button onclick="confirmNameYes()" class="main-btn confirm-btn" id="btnYes">–ò”ô ‚úÖ</button>
                <button onclick="confirmNameNo()" class="main-btn deny-btn" id="btnNo">–ñ–æ“õ ‚ùå</button>
            </div>
        </div>

        <div id="inputNameBlock">
            <input type="text" id="nameInput" placeholder="–ï—Å—ñ–º—ñ“£—ñ–∑...">
            <div id="errorMsg"></div>
            <button onclick="startJourney()" class="main-btn" id="btnStart">–ë–∞—Å—Ç–∞—É ü§≤</button>
        </div>
    </div>

    <div id="journeyScreen" class="card hidden">
        <div id="captureArea" style="padding: 10px; border-radius: 15px;">
            <div id="mainCountdown" class="countdown-box"></div>

            <div id="chestWrapper" class="chest-wrapper" onclick="openChest()">
                <div class="chest-icon">üéÅ</div>
                <div class="chest-hint" id="chestHint">–°—ã–π–ª—ã“õ—Ç—ã –∞—à—É “Ø—à—ñ–Ω –±–∞—Å—ã“£—ã–∑!</div>
            </div>

            <div id="contentWrapper" class="hidden">
                <h2 id="cityName" class="city-name">City</h2>
                <div id="greetingMsg" class="greeting-text">...</div>
                <div id="poemBox" class="poem-box">...</div>
            </div>
        </div>
        
        <div id="controlButtons" class="hidden" style="margin-top: 10px;">
            <button onclick="downloadCard()" class="main-btn download-btn" id="btnDownload">üì∏ –°—É—Ä–µ—Ç —Ä–µ—Ç—ñ–Ω–¥–µ –∂“Ø–∫—Ç–µ—É</button>
            <button onclick="nextCity()" class="main-btn" id="btnNext">–ö–µ–ª–µ—Å—ñ –µ–ª ‚úàÔ∏è</button>
            <button onclick="shareGreeting()" class="main-btn share-btn" id="btnShare">–ë”©–ª—ñ—Å—É üîó</button>
        </div>
    </div>

    <div id="stats-container">
        <a href="https://info.flagcounter.com/YourNewID" target="_blank">
            <img src="https://s11.flagcounter.com/count2/p2x2/bg_000000/txt_FFFFFF/border_CCCCCC/columns_4/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/percent_0/" alt="Flag Counter" border="0">
        </a>
    </div>

    <script>
        const targetDate = new Date("January 1, 2026 00:00:00").getTime();

        // --- –ê–£–î–ê–†–ú–ê–õ–ê–† ---
        const translations = {
            kk: {
                ui: { 
                    title: "–ë–µ—Ä–µ–∫–µ–ª—ñ 2026 –ñ—ã–ª", desc: "–ê—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑:", ph: "–ê—Ç—ã“£—ã–∑...", start: "–ë–∞—Å—Ç–∞—É ü§≤", next: "–ö–µ–ª–µ—Å—ñ –µ–ª ‚úàÔ∏è", share: "–ë”©–ª—ñ—Å—É üîó", download: "üì∏ –û—Ç–∫—Ä—ã—Ç–∫–∞ –∂“Ø–∫—Ç–µ—É", hint: "–°—ã–π–ª—ã“õ—Ç—ã –∞—à—É “Ø—à—ñ–Ω –±–∞—Å—ã“£—ã–∑! üéÅ", days: "–∫“Ø–Ω", hours: "—Å–∞“ì", mins: "–º–∏–Ω", secs: "—Å–µ–∫",
                    err_char: "–ö–µ—à—ñ—Ä—ñ“£—ñ–∑, –∞—Ç—ã“£—ã–∑–¥–∞ “õ–∞—Ç–µ –∫–µ—Ç–∫–µ–Ω —Å–∏—è“õ—Ç—ã (—Å–∞–Ω–¥–∞—Ä –Ω–µ–º–µ—Å–µ –±–µ–ª–≥—ñ–ª–µ—Ä –±–∞—Ä).", err_rep: "–ö–µ—à—ñ—Ä—ñ“£—ñ–∑, –±—ñ—Ä ”ô—Ä—ñ–ø —Ç—ã–º –∫”©–ø “õ–∞–π—Ç–∞–ª–∞–Ω“ì–∞–Ω —Å–∏—è“õ—Ç—ã.",
                    conf_q: "–°—ñ–∑–¥—ñ“£ –∞—Ç—ã“£—ã–∑ {name} –±–∞?", yes: "–ò”ô ‚úÖ", no: "–ñ–æ“õ ‚ùå"
                },
                // ”®–ó–ì–ï–†–¢–Ü–õ–ì–ï–ù ”®–õ–ï“¢–î–ï–†:
                coming: { greet: "“ö“±—Ä–º–µ—Ç—Ç—ñ {name}, –∫–µ–ª–µ –∂–∞—Ç“õ–∞–Ω –ñ–∞“£–∞ –∂—ã–ª–¥–∞ –ê–ª–ª–∞ –¢–∞“ì–∞–ª–∞ –µ–∫—ñ –¥“Ø–Ω–∏–µ–Ω—ñ“£ –∂–∞“õ—Å—ã–ª—ã“ì—ã–Ω –Ω”ô—Å—ñ–ø –µ—Ç—Å—ñ–Ω!", poem: "–ê–ª–ª–∞ “õ–æ–ª–¥–∞–ø ”ô—Ä —ñ—Å—ñ“£–¥—ñ –æ“£ “õ—ã–ª—Å—ã–Ω,\n–†–∏–∑—ã“õ-–Ω–µ—Å—ñ–±–µ“£ –∞–¥–∞–ª—ã–Ω–∞–Ω –º–æ–ª –±–æ–ª—Å—ã–Ω.\n–ö–µ–ª–µ –∂–∞—Ç“õ–∞–Ω –∂—ã–ª–¥–∞ –±”ô—Ä—ñ –∂–∞“£–∞—Ä—ã–ø,\n–ò–º–∞–Ω—ã“£—ã–∑ –Ω“±—Ä“ì–∞ —Ç–æ–ª–∞—Ä –∂—ã–ª –±–æ–ª—Å—ã–Ω!" },
                arrived: { greet: "“ö“±—Ä–º–µ—Ç—Ç—ñ {name}, –∫–µ–ª—ñ–ø –∂–µ—Ç–∫–µ–Ω –ñ–∞“£–∞ –∂—ã–ª–¥–∞ –ê–ª–ª–∞ –¢–∞“ì–∞–ª–∞ ”ô—Ä–±—ñ—Ä –∫“Ø–Ω—ñ“£—ñ–∑–≥–µ –±–µ—Ä–µ–∫–µ –±–µ—Ä—Å—ñ–Ω!", poem: "–ñ–∞“£–∞ –∂—ã–ª–¥–∞ –∂–∞“õ—Å—ã–ª—ã“õ—Ç–∞—Ä –∫”©–ø –±–æ–ª—Å—ã–Ω,\n–£–∞–π—ã–º-“õ–∞–π“ì—ã –µ—à“õ–∞—à–∞–Ω–¥–∞ –∂–æ“õ –±–æ–ª—Å—ã–Ω.\n–ê–ª–ª–∞ –±–µ—Ä–≥–µ–Ω “ì“±–º—ã—Ä—ã“£—ã–∑ –º”ô–Ω–¥—ñ –±–æ–ø,\n–î–∞—Å—Ç–∞—Ä—Ö–∞–Ω—ã“£ –∞–¥–∞–ª –∞—Å“õ–∞ –ª—ã“õ —Ç–æ–ª—Å—ã–Ω!" }
            },
            ru: {
                ui: { 
                    title: "–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω—ã–π 2026", desc: "–í–≤–µ–¥–∏—Ç–µ –∏–º—è:", ph: "–í–∞—à–µ –∏–º—è...", start: "–û—Ç–∫—Ä—ã—Ç—å ü§≤", next: "–°–ª–µ–¥. —Å—Ç—Ä–∞–Ω–∞ ‚úàÔ∏è", share: "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è üîó", download: "üì∏ –°–∫–∞—á–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç–∫—É", hint: "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—É–Ω–¥—É–∫! üéÅ", days: "–¥–Ω", hours: "—á", mins: "–º", secs: "—Å",
                    err_char: "–ò–∑–≤–∏–Ω–∏—Ç–µ, –∫–∞–∂–µ—Ç—Å—è –≤ –∏–º–µ–Ω–∏ –æ—à–∏–±–∫–∞ (–µ—Å—Ç—å —Ü–∏—Ñ—Ä—ã –∏–ª–∏ —Å–∏–º–≤–æ–ª—ã).", err_rep: "–ò–∑–≤–∏–Ω–∏—Ç–µ, —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –±—É–∫–≤.",
                    conf_q: "–í–∞—Å –∑–æ–≤—É—Ç {name}?", yes: "–î–∞ ‚úÖ", no: "–ù–µ—Ç ‚ùå"
                },
                coming: { greet: "–£–≤–∞–∂–∞–µ–º—ã–π(–∞—è) {name}, –≤ –Ω–∞—Å—Ç—É–ø–∞—é—â–µ–º –≥–æ–¥—É –ø—É—Å—Ç—å –í—Å–µ–≤—ã—à–Ω–∏–π –¥–∞—Ä—É–µ—Ç –≤–∞–º –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ!", poem: "–ü—É—Å—Ç—å –ê–ª–ª–∞—Ö —Ö—Ä–∞–Ω–∏—Ç –æ—Ç –±–µ–¥,\n–î–∞—Ä–∏—Ç –º—É–¥—Ä–æ—Å—Ç—å –∏ —Å–æ–≤–µ—Ç.\n–í –Ω–∞—Å—Ç—É–ø–∞—é—â–µ–º –≥–æ–¥—É,\n–û—Ç–≤–æ–¥–∏—Ç –≥–æ—Ä–µ –∏ –±–µ–¥—É." },
                arrived: { greet: "–£–≤–∞–∂–∞–µ–º—ã–π(–∞—è) {name}, –≤ –Ω–∞—Å—Ç—É–ø–∏–≤—à–µ–º –≥–æ–¥—É –ø—É—Å—Ç—å –í—Å–µ–≤—ã—à–Ω–∏–π –Ω–∞–ø–æ–ª–Ω–∏—Ç –≤–∞—à –¥–æ–º –±–∞—Ä–∞–∫–∞—Ç–æ–º!", poem: "–ì–æ–¥ –ø—Ä–∏—à–µ–ª, —Ö–≤–∞–ª–∞ –¢–≤–æ—Ä—Ü—É,\n–°—á–∞—Å—Ç—å–µ –ø—É—Å—Ç—å –ø—Ä–∏–¥–µ—Ç –∫ –ª–∏—Ü—É.\n–ú–∏—Ä, –ø–æ–∫–æ–π –∏ –±–ª–∞–≥–æ–¥–∞—Ç—å,\n–ë—É–¥—É—Ç –¥–æ–º –≤–∞—à –Ω–∞–ø–æ–ª–Ω—è—Ç—å." }
            },
            en: {
                ui: { 
                    title: "Blessed 2026", desc: "Enter name:", ph: "Name...", start: "Start ü§≤", next: "Next ‚úàÔ∏è", share: "Share üîó", download: "üì∏ Save Card", hint: "Tap the chest! üéÅ", days: "d", hours: "h", mins: "m", secs: "s",
                    err_char: "Sorry, it seems there is a mistake (digits or symbols).", err_rep: "Sorry, too many repeated letters.",
                    conf_q: "Is your name {name}?", yes: "Yes ‚úÖ", no: "No ‚ùå"
                },
                coming: { greet: "Dear {name}, may the Almighty grant you success and halal sustenance in the coming year!", poem: "May Allah guide you day by day,\nKeep all troubles far away.\nIn the coming year so new,\nMay His blessings be with you." },
                arrived: { greet: "Dear {name}, may the Almighty fill your life with peace and faith in this new year!", poem: "New year is here, bright and clear,\nMay faith in heart be ever near.\nGoodness, health, and halal wealth,\nJoy and peace and spiritual health." }
            },
            zh: { ui: { title: "ÂêâÁ•• 2026", desc: "ËæìÂÖ•ÊÇ®ÁöÑÂêçÂ≠ó:", ph: "ÂêçÂ≠ó...", start: "ÂºÄÂßã ü§≤", next: "‰∏ã‰∏Ä‰∏™", share: "ÂàÜ‰∫´", download: "üì∏ ‰∏ãËΩΩ", hint: "ÁÇπÂáªÂÆùÁÆ±!", days: "Â§©", hours: "Êó∂", mins: "ÂàÜ", secs: "Áßí", err_char: "ÂêçÂ≠óÊúâËØØÔºàÂåÖÂê´Êï∞Â≠óÊàñÁ¨¶Âè∑Ôºâ„ÄÇ", err_rep: "ÈáçÂ§çÂ≠óÁ¨¶ËøáÂ§ö„ÄÇ", conf_q: "ÊÇ®Âè´ {name} ÂêóÔºü", yes: "ÊòØ", no: "‰∏ç" }, coming: { greet: "‰∫≤Áà±ÁöÑ {name}ÔºåÊÑøÁúü‰∏ªÂú®Êù•Âπ¥Ëµê‰∫àÊÇ®ÂêàÊ≥ïÁöÑÁªôÂÖªÂíåÊàêÂäüÔºÅ", poem: "ÊÑøÁúü‰∏ªËµêÁ¶èÊñ∞‰∏ÄÂπ¥Ôºå\nÂπ≥ÂÆâÂñú‰πêÂ∏∏Áõ∏‰º¥„ÄÇ\nÊ≠£ÈÅìÂÖâËäíÁÖßÂøÉÈó¥Ôºå\nÁîüÊ¥ªÁæéÊª°Á¶èÊó†Ëæπ„ÄÇ" }, arrived: { greet: "‰∫≤Áà±ÁöÑ {name}ÔºåÊÑøÁúü‰∏ªÂú®Êñ∞ÁöÑ‰∏ÄÂπ¥ÈáåËÆ©ÊÇ®ÁöÑÁîüÊ¥ªÂÖÖÊª°Âπ≥ÂÆâ‰∏é‰ø°‰ª∞ÔºÅ", poem: "Êñ∞Âπ¥Â∑≤Ëá≥ÂñúÊ∞îÊµìÔºå\nÂøÉ‰∏≠‰ø°‰ª∞Êó∂ÂàªÂêå„ÄÇ\nÂÅ•Â∫∑Ë¥¢ÂØåÊ∫êÂêàÊ≥ïÔºå\nÂπ∏Á¶èÂÆâÂ∫∑‰º¥‰∏ÄÁîü„ÄÇ" } },
            es: { ui: { title: "Bendito 2026", desc: "Nombre:", ph: "Nombre...", start: "Empezar", next: "Siguiente", share: "Compartir", download: "üì∏ Descargar", hint: "¬°Toca el cofre!", days: "d", hours: "h", mins: "m", secs: "s", err_char: "Error en el nombre (d√≠gitos o s√≠mbolos).", err_rep: "Demasiadas letras repetidas.", conf_q: "¬øEres {name}?", yes: "S√≠", no: "No" }, coming: { greet: "Querido/a {name}, ¬°que Al√° te bendiga!", poem: "Que Allah gu√≠e tu caminar,\nY te aleje de todo mal.\nEn este a√±o que va a empezar,\nMucha paz te va a regalar." }, arrived: { greet: "Querido/a {name}, ¬°feliz a√±o nuevo!", poem: "El a√±o nuevo ya lleg√≥,\nLa fe en el alma floreci√≥.\nSalud y paz en tu hogar,\nBendiciones sin cesar." } },
            fr: { ui: { title: "B√©ni 2026", desc: "Nom:", ph: "Nom...", start: "Commencer", next: "Suivant", share: "Partager", download: "üì∏ T√©l√©charger", hint: "Appuyez sur le coffre!", days: "j", hours: "h", mins: "m", secs: "s", err_char: "Erreur dans le nom (chiffres ou symboles).", err_rep: "Trop de lettres r√©p√©t√©es.", conf_q: "Est-ce vous, {name}?", yes: "Oui", no: "Non" }, coming: { greet: "Cher {name}, qu'Allah vous b√©nisse !", poem: "Qu'Allah √©claire votre chemin,\nEt vous prot√®ge chaque matin.\nQue cette ann√©e soit un festin,\nDe paix et d'amour sans fin." }, arrived: { greet: "Cher {name}, bonne ann√©e !", poem: "Le nouvel an est arriv√©,\nQue votre foi soit pr√©serv√©e.\nBonheur, sant√© et puret√©,\nPour toute l'√©ternit√©." } },
            hi: { ui: { title: "Mubarak 2026", desc: "Naam:", ph: "Naam...", start: "Shuru", next: "Agla", share: "Share", download: "üì∏ Save", hint: "Sandook kholein!", days: "d", hours: "h", mins: "m", secs: "s", err_char: "Naam mein ghalti hai (digits/symbols).", err_rep: "Akshar bar-bar aa rahe hain.", conf_q: "Kya aap {name} hain?", yes: "Haan", no: "Nahi" }, coming: { greet: "Pyare {name}, Allah aap par rehmat kare!", poem: "Allah ki rehmat barse aap par,\nKhushiyon se bhar jaye ghar.\nHar mushkil ho jaye aasan,\nNaye saal mein mile sukoon-o-aman." }, arrived: { greet: "Pyare {name}, naya saal mubarak!", poem: "Naya saal aaya hai roshan hokar,\nDil mein iman rahe hamesha jagmagakar.\nAcchai, sehat aur halal kamai,\nKhushi aur aman ki ho bharpayi." } },
            tr: { ui: { title: "Bereketli 2026", desc: "Adƒ±nƒ±z:", ph: "Adƒ±nƒ±z...", start: "Ba≈üla", next: "Sonraki", share: "Payla≈ü", download: "üì∏ ƒ∞ndir", hint: "Sandƒ±ƒüa tƒ±kla!", days: "g", hours: "s", mins: "dk", secs: "sn", err_char: "ƒ∞simde hata var (rakam veya sembol).", err_rep: "√áok fazla tekrarlanan harf.", conf_q: "Adƒ±nƒ±z {name} mƒ±?", yes: "Evet", no: "Hayƒ±r" }, coming: { greet: "Sevgili {name}, Allah razƒ± olsun!", poem: "Rabbim yolunu a√ßƒ±k etsin,\nHer t√ºrl√º dertten seni korusun.\nYeni yƒ±lda t√ºm dualarƒ±n,\nHayƒ±rlƒ±sƒ±yla kabul olsun." }, arrived: { greet: "Sevgili {name}, yeni yƒ±lƒ±nƒ±z m√ºbarek olsun!", poem: "Yeni yƒ±l geldi ho≈ü geldi,\nG√∂nl√ºne iman dolsun ebedi.\nRabbimden dilerim saadet,\nHayatƒ±n olsun hep selamet." } },
            ar: { ui: { title: "ÿπÿßŸÖ ŸÖÿ®ÿßÿ±ŸÉ 2026", desc: "ÿßŸÑÿßÿ≥ŸÖ:", ph: "ÿßŸÑÿßÿ≥ŸÖ...", start: "ÿßÿ®ÿØÿ£", next: "ÿßŸÑÿ™ÿßŸÑŸä", share: "ŸÖÿ¥ÿßÿ±ŸÉÿ©", download: "üì∏ ÿ™ÿ≠ŸÖŸäŸÑ", hint: "ÿßÿ∂ÿ∫ÿ∑ ÿßŸÑÿµŸÜÿØŸàŸÇ!", days: "Ÿä", hours: "ÿ≥", mins: "ÿØ", secs: "ÿ´", err_char: "ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ≥ŸÖ (ÿ£ÿ±ŸÇÿßŸÖ ÿ£Ÿà ÿ±ŸÖŸàÿ≤).", err_rep: "ÿ£ÿ≠ÿ±ŸÅ ŸÖŸÉÿ±ÿ±ÿ© ŸÉÿ´Ÿäÿ±ÿß.", conf_q: "ŸáŸÑ ÿ£ŸÜÿ™ {name}ÿü", yes: "ŸÜÿπŸÖ", no: "ŸÑÿß" }, coming: { greet: "ÿπÿ≤Ÿäÿ≤Ÿä {name}ÿå ÿ®ÿßÿ±ŸÉ ÿßŸÑŸÑŸá ŸÅŸäŸÉ!", poem: "Ÿäÿß ÿ±ÿ® ÿ®ÿßÿ±ŸÉ ŸÅŸä ÿßŸÑÿπÿßŸÖ ÿßŸÑÿ¨ÿØŸäÿØÿå\nŸàÿßÿ¨ÿπŸÑ ÿ≠Ÿäÿßÿ© {name} ŸÅŸä ÿπŸäÿØ.\nÿ®ÿßŸÑÿ•ŸäŸÖÿßŸÜ ŸàÿßŸÑÿ™ŸÇŸàŸâ ÿ™ÿ≤ŸäÿØÿå\nŸàÿ±ÿ∂ÿß ÿßŸÑÿ±ÿ≠ŸÖŸÜ ŸáŸà ÿßŸÑŸÖÿ≤ŸäÿØ." }, arrived: { greet: "ÿπÿ≤Ÿäÿ≤Ÿä {name}ÿå ÿπÿßŸÖ ÿ≥ÿπŸäÿØ!", poem: "ÿπÿßŸÖ ÿ¨ÿØŸäÿØ ÿ£ŸÇÿ®ŸÑ ÿπŸÑŸäŸÜÿßÿå\nŸÜÿ≥ÿ£ŸÑ ÿßŸÑŸÑŸá ÿßŸÑŸÑÿ∑ŸÅ ŸÅŸäŸÜÿß.\nÿßÿ±ÿ≤ŸÇŸÜÿß Ÿäÿß ÿ±ÿ® ÿßŸÑÿ¨ŸÜÿßŸÜÿå\nŸàÿßÿ≠ŸÅÿ∏ŸÜÿß ŸÖŸÜ ŸÉŸÑ ÿ¥Ÿäÿ∑ÿßŸÜ." } }
        };

        const destinations = [
            { name: "Astana üá∞üáø", coords: [51.16, 71.47], lang: "kk" },
            { name: "Beijing üá®üá≥", coords: [39.90, 116.40], lang: "zh" },
            { name: "Mecca üá∏üá¶", coords: [21.38, 39.85], lang: "ar" },
            { name: "Istanbul üáπüá∑", coords: [41.00, 28.97], lang: "tr" },
            { name: "London üá¨üáß", coords: [51.50, -0.12], lang: "en" },
            { name: "Madrid üá™üá∏", coords: [40.41, -3.70], lang: "es" },
            { name: "Paris üá´üá∑", coords: [48.85, 2.35], lang: "fr" },
            { name: "New Delhi üáÆüá≥", coords: [28.61, 77.20], lang: "hi" },
            { name: "Tashkent üá∫üáø", coords: [41.29, 69.24], lang: "ru" }
        ];

        let map, planeMarker;
        let currentDestIndex = 0;
        let userName = "–î–æ—Å—ã–º";
        let isMusicPlaying = false;
        const audio = document.getElementById('bgMusic');

        window.onload = () => {
            initMap();
            setInterval(updateCountdown, 1000);
            updateCountdown(); 
            
            const urlParams = new URLSearchParams(window.location.search);
            const sharedName = urlParams.get('name');

            if (sharedName) {
                document.getElementById('confirmNameBlock').classList.remove('hidden');
                document.getElementById('inputNameBlock').classList.add('hidden');
                document.getElementById('detectedName').textContent = sharedName;
                userName = sharedName;
            }

            changeLanguage();
        };

        function initMap() {
            map = L.map('map', { zoomControl: false }).setView([51.16, 71.47], 4);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '', subdomains: 'abcd', maxZoom: 19 }).addTo(map);
            const planeIcon = L.divIcon({ html: '<div style="font-size: 30px; transform: rotate(-45deg);">‚úàÔ∏è</div>', className: 'plane-icon', iconSize: [30, 30], iconAnchor: [15, 15] });
            planeMarker = L.marker([51.16, 71.47], {icon: planeIcon}).addTo(map);
        }

        function validateName(name) {
            const invalidChars = /[0-9!@#$%^&*()_+={}\[\]|\\:;"'<>,.?/~`]/;
            if (invalidChars.test(name)) return "char";
            if (/(.)\1{3,}/.test(name)) return "repeat";
            return "ok";
        }

        function startJourney() {
            const inputVal = document.getElementById('nameInput').value.trim();
            const lang = document.getElementById('uiLangSelect').value;
            const t = translations[lang].ui;
            const errorDiv = document.getElementById('errorMsg');

            if (!inputVal) {
                userName = "–î–æ—Å—ã–º";
            } else {
                const status = validateName(inputVal);
                if (status === "char") {
                    errorDiv.textContent = t.err_char;
                    errorDiv.style.display = 'block';
                    return; 
                } else if (status === "repeat") {
                    errorDiv.textContent = t.err_rep;
                    errorDiv.style.display = 'block';
                    return; 
                }
                userName = inputVal;
            }

            errorDiv.style.display = 'none';
            proceedToJourney();
        }

        function confirmNameYes() {
            proceedToJourney();
        }

        function confirmNameNo() {
            document.getElementById('confirmNameBlock').classList.add('hidden');
            document.getElementById('inputNameBlock').classList.remove('hidden');
            document.getElementById('nameInput').value = "";
        }

        function proceedToJourney() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('journeyScreen').classList.remove('hidden');
            if(!isMusicPlaying) toggleMusic();

            const lang = document.getElementById('uiLangSelect').value;
            const cityIndex = destinations.findIndex(d => d.lang === lang);
            if(cityIndex !== -1) currentDestIndex = cityIndex;

            const city = destinations[currentDestIndex];
            map.flyTo(city.coords, 5, { duration: 2.5 });
            planeMarker.setLatLng(city.coords);
        }

        function updateCountdown() {
            const now = new Date().getTime();
            const distance = targetDate - now;
            const lang = document.getElementById('uiLangSelect').value;
            const t = translations[lang].ui;

            if (distance < 0) {
                const msg = "üéâ 2026!";
                document.getElementById('loginCountdown').textContent = msg;
                document.getElementById('mainCountdown').textContent = msg;
            } else {
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                const timeStr = `‚è≥ ${days}${t.days} ${hours}${t.hours} ${minutes}${t.mins} ${seconds}${t.secs}`;
                
                document.getElementById('loginCountdown').textContent = timeStr;
                document.getElementById('mainCountdown').textContent = timeStr;
            }
        }

        function changeLanguage() {
            const lang = document.getElementById('uiLangSelect').value;
            const t = translations[lang].ui;

            document.querySelector('#loginScreen h1').textContent = t.title;
            document.getElementById('appDesc').textContent = t.desc;
            document.getElementById('nameInput').placeholder = t.ph;
            document.getElementById('btnStart').textContent = t.start;
            document.getElementById('chestHint').textContent = t.hint;

            document.getElementById('confirmQuestion').innerHTML = t.conf_q.replace("{name}", `<b style="color:#FFD700">${userName}</b>`);
            document.getElementById('btnYes').textContent = t.yes;
            document.getElementById('btnNo').textContent = t.no;

            if (!document.getElementById('contentWrapper').classList.contains('hidden')) {
                updateCardContent();
            }
        }

        function toggleMusic() {
            if (isMusicPlaying) { audio.pause(); isMusicPlaying = false; document.getElementById('musicBtn').textContent = "üîá"; } 
            else { audio.play(); isMusicPlaying = true; document.getElementById('musicBtn').textContent = "üéµ"; }
        }

        function openChest() {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, shapes: ['circle'], colors: ['#FFD700', '#FF0000', '#00FF00'] });
            const scalar = 3;
            const emojis = confetti.shapeFromText({ text: 'üê¥', scalar });
            const flowers = confetti.shapeFromText({ text: 'üå∏', scalar });
            confetti({ particleCount: 15, scalar: 3, spread: 100, origin: { y: 0.7 }, shapes: [emojis, flowers] });

            document.getElementById('chestWrapper').style.display = 'none';
            document.getElementById('contentWrapper').classList.remove('hidden');
            document.getElementById('controlButtons').classList.remove('hidden');
            updateCardContent();
        }

        function updateCardContent() {
            const city = destinations[currentDestIndex];
            const langCode = city.lang;
            document.getElementById('uiLangSelect').value = langCode;
            
            const t = translations[langCode];
            const now = new Date().getTime();
            const data = (now >= targetDate) ? t.arrived : t.coming;

            document.getElementById('cityName').textContent = city.name;
            document.getElementById('greetingMsg').innerHTML = data.greet.replace("{name}", `<b style="color:#FFD700">${userName}</b>`);
            document.getElementById('poemBox').textContent = data.poem;
            
            document.getElementById('btnNext').textContent = t.ui.next;
            document.getElementById('btnShare').textContent = t.ui.share;
            document.getElementById('btnDownload').textContent = t.ui.download;
        }

        function nextCity() {
            currentDestIndex = (currentDestIndex + 1) % destinations.length;
            const city = destinations[currentDestIndex];
            map.flyTo(city.coords, 5, { duration: 2.5 });
            planeMarker.setLatLng(city.coords);
            updateCardContent();
        }

        function shareGreeting() {
            const url = window.location.href.split('?')[0] + "?name=" + encodeURIComponent(userName);
            if (navigator.share) { navigator.share({ title: '2026 Wish', url: url }); } 
            else { navigator.clipboard.writeText(url); alert("Copied!"); }
        }

        function downloadCard() {
            const captureElement = document.getElementById('captureArea');
            captureElement.style.background = "rgba(0, 20, 40, 0.9)"; 
            html2canvas(captureElement, { backgroundColor: null, scale: 2 }).then(canvas => {
                captureElement.style.background = ""; 
                const link = document.createElement('a');
                link.download = 'NewYear2026_Greeting.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }
    </script>
</body>
</html>
