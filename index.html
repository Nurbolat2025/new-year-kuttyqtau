<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global 2026 Greeting</title>
    
    <!-- PWA Ñ‚Ğ¾Ğ»Ñ‹Ò› Ò›Ğ¾Ğ»Ğ´Ğ°Ñƒ -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d47a1">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Confetti & Screenshot -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            height: 100vh; display: flex; flex-direction: column; 
            font-family: 'Segoe UI', Tahoma, sans-serif; background: #0b1622; color: white; overflow: hidden;
        }
        #map { width: 100%; height: 40vh; }
        #sidebar {
            flex: 1; display: flex; flex-direction: column; align-items: center; 
            justify-content: flex-start; padding: 20px; background: linear-gradient(180deg, #1b263b, #415a77); overflow-y: auto;
        }
        .top-controls { 
            position: absolute; top: 10px; right: 10px; z-index: 1000; display: flex; gap: 10px; 
        }
        .icon-btn { 
            background: rgba(0,0,0,0.6); color: white; border-radius: 50%; width: 44px; height: 44px; 
            font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; 
        }
        .lang-select { 
            background: rgba(255,255,255,0.95); color: #000; border-radius: 20px; padding: 8px 12px; 
            font-weight: bold; font-size: 16px; border: none; 
        }
        h1 { color: #FFD700; text-shadow: 0 0 15px #FF8C00; font-size: 2.2rem; margin: 20px 0 10px; text-align: center; }
        .countdown-box { 
            background: rgba(0,255,255,0.1); color: #84ffff; padding: 15px; border-radius: 15px; 
            font-size: 1.3rem; width: 95%; text-align: center; border: 1px solid rgba(132,255,255,0.3); margin-bottom: 20px;
        }
        .time-info { 
            font-size: 1.2rem; color: #84ffff; margin: 15px 0; text-align: center; width: 95%; 
        }
        .chest-wrapper { margin: 30px 0; cursor: pointer; animation: float 3s ease-in-out infinite; text-align: center; }
        .chest-icon { font-size: 120px; filter: drop-shadow(0 0 30px gold); }
        .chest-hint { font-size: 1.1rem; color: #ddd; margin-top: 10px; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .card-content { 
            background: rgba(255,255,255,0.1); padding: 25px; border-radius: 25px; width: 95%; 
            text-align: center; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;
        }
        .city-name { font-size: 2.5rem; color: #4DD0E1; margin: 15px 0; text-shadow: 3px 3px 6px black; }
        .greeting-text { font-size: 1.4rem; line-height: 1.7; margin: 20px 0; }
        .poem-box { 
            background: rgba(0,40,0,0.6); padding: 25px; border-radius: 20px; margin: 25px 0; 
            border-left: 6px solid #FFD700; font-style: italic; white-space: pre-line; 
            color: #fffde7; font-size: 1.2rem; line-height: 1.8; 
        }
        input { 
            width: 90%; padding: 18px; margin: 15px 0; border-radius: 20px; border: none; 
            text-align: center; font-size: 1.2rem; background: rgba(255,255,255,0.2); color: white;
        }
        input::placeholder { color: rgba(255,255,255,0.7); }
        .main-btn { 
            width: 90%; padding: 18px; margin: 12px 0; border-radius: 20px; border: none; 
            font-size: 1.3rem; font-weight: bold; background: linear-gradient(135deg, #FFD700 0%, #FFA000 100%); 
            color: #000; cursor: pointer; box-shadow: 0 8px 25px rgba(255,215,0,0.4); 
        }
        .main-btn:active { transform: scale(0.98); }
        .download-btn { background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); color: white; }
        .share-btn { background: linear-gradient(135deg, #778beb 0%, #546de5 100%); color: white; }
        .hidden { display: none !important; }
        .plane-icon { font-size: 60px; animation: fly 2s ease-in-out infinite; }
        @keyframes fly { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        
        /* Ğ”ĞµÑĞºÑ‚Ğ¾Ğ¿ */
        @media (min-width: 769px) {
            body { flex-direction: row; }
            #map { height: 100vh; }
            #sidebar { width: 40%; }
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="top-controls">
        <button id="musicBtn" class="icon-btn" onclick="toggleMusic()">ğŸ”‡</button>
        <select id="uiLangSelect" class="lang-select" onchange="changeLanguage()">
            <option value="kk">ğŸ‡°ğŸ‡¿ ÒšĞ°Ğ·Ğ°Ò›</option>
            <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
            <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
            <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
            <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
            <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
            <option value="mn">ğŸ‡²ğŸ‡³ ĞœĞ¾Ğ½Ğ³Ğ¾Ğ»</option>
        </select>
    </div>

    <div id="sidebar">
        <div id="loginScreen" style="width: 100%; text-align: center;">
            <h1>ğŸŒ™ Ğ‘ĞµÑ€ĞµĞºĞµĞ»Ñ– 2026</h1>
            <div id="loginCountdown" class="countdown-box">Ğ–Ò¯ĞºÑ‚ĞµĞ»ÑƒĞ´Ğµ...</div>
            <p id="appDesc">ĞĞ´Ğ°Ğ» Ğ½Ğ¸ĞµÑ‚Ğ¿ĞµĞ½ Ò›Ò±Ñ‚Ñ‚Ñ‹Ò›Ñ‚Ğ°Ñƒ Ğ¶Ğ¾Ğ»Ğ´Ğ°Ò£Ñ‹Ğ·!</p>
            
            <div id="inputNameBlock">
                <input type="text" id="nameInput" placeholder="ÒšÒ±Ñ‚Ñ‚Ñ‹Ò›Ñ‚Ğ°Ğ¹Ñ‚Ñ‹Ğ½ Ğ°Ğ´Ğ°Ğ¼Ğ½Ñ‹Ò£ Ğ°Ñ‚Ñ‹">
                <div id="errorMsg" style="color: #FF5252; display: none;"></div>
                <button onclick="startJourney()" class="main-btn" id="btnStart">Ğ‘Ğ°ÑÑ‚Ğ°Ñƒ ğŸ¤²</button>
            </div>
        </div>

        <div id="journeyScreen" class="hidden" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
            <div id="captureArea" class="card-content">
                <div id="mainCountdown" class="countdown-box"></div>
                <div id="timeInfo" class="time-info"></div>
                <div id="chestWrapper" class="chest-wrapper" onclick="openChest()">
                    <div class="chest-icon">ğŸ</div>
                    <div class="chest-hint" id="chestHint">ĞÑˆÑƒ Ò¯ÑˆÑ–Ğ½ Ğ±Ğ°ÑÑ‹Ò£Ñ‹Ğ·!</div>
                </div>
                <div id="contentWrapper" class="hidden">
                    <h2 id="cityName" class="city-name"></h2>
                    <div id="greetingMsg" class="greeting-text"></div>
                    <div id="poemBox" class="poem-box"></div>
                </div>
            </div>

            <div id="controlButtons" class="hidden" style="width: 100%; padding: 10px;">
                <button onclick="downloadCard()" class="main-btn download-btn">ğŸ“¸ Ğ¡ÑƒÑ€ĞµÑ‚ Ğ¶Ò¯ĞºÑ‚ĞµÑƒ</button>
                <button onclick="nextCity()" class="main-btn">ĞšĞµĞ»ĞµÑÑ– ĞµĞ» âœˆï¸</button>
                <button onclick="shareGreeting()" class="main-btn share-btn">Ğ‘Ó©Ğ»Ñ–ÑÑƒ ğŸ”—</button>
            </div>
        </div>
    </div>

    <!-- Ğ¤Ğ¾Ğ½Ğ´Ñ‹Ò› Ğ¼ÑƒĞ·Ñ‹ĞºĞ° (Ğ²Ğ¾ĞºĞ°Ğ»ÑÑ‹Ğ·, Ñ‚Ñ‹Ğ½Ñ‹Ñˆ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ») -->
    <audio id="bgMusic" loop>
        <source src="https://cdn.pixabay.com/download/audio/2023/03/21/audio_8d5d8d5d8f.mp3?filename=relaxing-149407.mp3" type="audio/mp3">
    </audio>

    <script>
        const targetDate = new Date("January 1, 2026 00:00:00").getTime();

        const translations = {
            kk: {
                ui: { title: "Ğ‘ĞµÑ€ĞµĞºĞµĞ»Ñ– 2026", desc: "ĞÑ‚Ñ‹Ò£Ñ‹Ğ·Ğ´Ñ‹ ĞµĞ½Ğ³Ñ–Ğ·Ñ–Ò£Ñ–Ğ·:", ph: "ĞÑ‚Ñ‹Ò£Ñ‹Ğ·...", start: "Ğ‘Ğ°ÑÑ‚Ğ°Ñƒ ğŸ¤²", next: "ĞšĞµĞ»ĞµÑÑ– ĞµĞ» âœˆï¸", share: "Ğ‘Ó©Ğ»Ñ–ÑÑƒ ğŸ”—", download: "ğŸ“¸ Ğ–Ò¯ĞºÑ‚ĞµÑƒ", hint: "ĞÑˆÑƒ Ò¯ÑˆÑ–Ğ½ Ğ±Ğ°ÑÑ‹Ò£Ñ‹Ğ·!", days: "ĞºÒ¯Ğ½", hours: "ÑĞ°Ò“Ğ°Ñ‚", mins: "Ğ¼Ğ¸Ğ½ÑƒÑ‚", secs: "ÑĞµĞºÑƒĞ½Ğ´" },
                coming: { greet: "ÒšÒ±Ñ€Ğ¼ĞµÑ‚Ñ‚Ñ– {name}, ĞºĞµĞ»Ğµ Ğ¶Ğ°Ñ‚Ò›Ğ°Ğ½ Ğ–Ğ°Ò£Ğ° Ğ¶Ñ‹Ğ»Ğ´Ğ° ĞĞ»Ğ»Ğ° Ğ¢Ğ°Ò“Ğ°Ğ»Ğ° ĞµĞºÑ– Ğ´Ò¯Ğ½Ğ¸ĞµĞ½Ñ–Ò£ Ğ¶Ğ°Ò›ÑÑ‹Ğ»Ñ‹Ò“Ñ‹Ğ½ Ğ½Ó™ÑÑ–Ğ¿ ĞµÑ‚ÑÑ–Ğ½!", poem: "ĞĞ»Ğ»Ğ° Ò›Ğ¾Ğ»Ğ´Ğ°Ğ¿ Ó™Ñ€ Ñ–ÑÑ–Ò£Ğ´Ñ– Ğ¾Ò£ Ò›Ñ‹Ğ»ÑÑ‹Ğ½,\nĞ Ğ¸Ğ·Ñ‹Ò›-Ğ½ĞµÑÑ–Ğ±ĞµÒ£ Ğ°Ğ´Ğ°Ğ»Ñ‹Ğ½Ğ°Ğ½ Ğ¼Ğ¾Ğ» Ğ±Ğ¾Ğ»ÑÑ‹Ğ½.\nĞšĞµĞ»Ğµ Ğ¶Ğ°Ñ‚Ò›Ğ°Ğ½ Ğ¶Ñ‹Ğ»Ğ´Ğ° Ğ±Ó™Ñ€Ñ– Ğ¶Ğ°Ò£Ğ°Ñ€Ñ‹Ğ¿,\nĞ˜Ğ¼Ğ°Ğ½Ñ‹Ò£Ñ‹Ğ· Ğ½Ò±Ñ€Ò“Ğ° Ñ‚Ğ¾Ğ»Ğ°Ñ€ Ğ¶Ñ‹Ğ» Ğ±Ğ¾Ğ»ÑÑ‹Ğ½!" },
                arrived: { greet: "ÒšÒ±Ñ€Ğ¼ĞµÑ‚Ñ‚Ñ– {name}, Ğ–Ğ°Ò£Ğ° Ğ¶Ñ‹Ğ»Ğ´Ğ° ĞĞ»Ğ»Ğ° Ó™Ñ€Ğ±Ñ–Ñ€ ĞºÒ¯Ğ½Ñ–Ò£Ñ–Ğ·Ğ³Ğµ Ğ±ĞµÑ€ĞµĞºĞµ Ğ±ĞµÑ€ÑÑ–Ğ½!", poem: "Ğ–Ğ°Ò£Ğ° Ğ¶Ñ‹Ğ»Ğ´Ğ° Ğ¶Ğ°Ò›ÑÑ‹Ğ»Ñ‹Ò›Ñ‚Ğ°Ñ€ ĞºÓ©Ğ¿ Ğ±Ğ¾Ğ»ÑÑ‹Ğ½,\nĞ£Ğ°Ğ¹Ñ‹Ğ¼-Ò›Ğ°Ğ¹Ò“Ñ‹ ĞµÑˆÒ›Ğ°ÑˆĞ°Ğ½Ğ´Ğ° Ğ¶Ğ¾Ò› Ğ±Ğ¾Ğ»ÑÑ‹Ğ½.\nĞĞ»Ğ»Ğ° Ğ±ĞµÑ€Ğ³ĞµĞ½ Ò“Ò±Ğ¼Ñ‹Ñ€Ñ‹Ò£Ñ‹Ğ· Ğ¼Ó™Ğ½Ğ´Ñ– Ğ±Ğ¾Ğ¿,\nĞ”Ğ°ÑÑ‚Ğ°Ñ€Ñ…Ğ°Ğ½Ñ‹Ò£ Ğ°Ğ´Ğ°Ğ» Ğ°ÑÒ›Ğ° Ğ»Ñ‹Ò› Ñ‚Ğ¾Ğ»ÑÑ‹Ğ½!" }
            },
            ru: {
                ui: { title: "Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ 2026", desc: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ¼Ñ:", ph: "Ğ’Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ...", start: "ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ğŸ¤²", next: "Ğ”Ğ°Ğ»ĞµĞµ âœˆï¸", share: "ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ", download: "ğŸ“¸ Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ", hint: "ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ ÑÑƒĞ½Ğ´ÑƒĞº!", days: "Ğ´", hours: "Ñ‡", mins: "Ğ¼", secs: "Ñ" },
                coming: { greet: "Ğ£Ğ²Ğ°Ğ¶Ğ°ĞµĞ¼Ñ‹Ğ¹(Ğ°Ñ) {name}, Ğ¿ÑƒÑÑ‚ÑŒ Ğ’ÑĞµĞ²Ñ‹ÑˆĞ½Ğ¸Ğ¹ Ğ´Ğ°Ñ€ÑƒĞµÑ‚ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğµ Ğ² Ğ½Ğ¾Ğ²Ğ¾Ğ¼ Ğ³Ğ¾Ğ´Ñƒ!", poem: "ĞŸÑƒÑÑ‚ÑŒ ĞĞ»Ğ»Ğ°Ñ… Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ¾Ñ‚ Ğ±ĞµĞ´,\nĞ”Ğ°Ñ€Ğ¸Ñ‚ Ğ¼ÑƒĞ´Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¸ ÑĞ¾Ğ²ĞµÑ‚.\nĞ’ Ğ½Ğ°ÑÑ‚ÑƒĞ¿Ğ°ÑÑ‰ĞµĞ¼ Ğ³Ğ¾Ğ´Ñƒ,\nĞÑ‚Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğ³Ğ¾Ñ€Ğµ Ğ¸ Ğ±ĞµĞ´Ñƒ." },
                arrived: { greet: "Ğ£Ğ²Ğ°Ğ¶Ğ°ĞµĞ¼Ñ‹Ğ¹(Ğ°Ñ) {name}, Ğ¿ÑƒÑÑ‚ÑŒ Ğ’ÑĞµĞ²Ñ‹ÑˆĞ½Ğ¸Ğ¹ Ğ½Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ Ğ´Ğ¾Ğ¼ Ğ±Ğ°Ñ€Ğ°ĞºĞ°Ñ‚Ğ¾Ğ¼!", poem: "Ğ“Ğ¾Ğ´ Ğ¿Ñ€Ğ¸ÑˆĞµĞ», Ñ…Ğ²Ğ°Ğ»Ğ° Ğ¢Ğ²Ğ¾Ñ€Ñ†Ñƒ,\nĞ¡Ñ‡Ğ°ÑÑ‚ÑŒĞµ Ğ¿ÑƒÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ´ĞµÑ‚ Ğº Ğ»Ğ¸Ñ†Ñƒ.\nĞœĞ¸Ñ€, Ğ¿Ğ¾ĞºĞ¾Ğ¹ Ğ¸ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ‚ÑŒ,\nĞ‘ÑƒĞ´ÑƒÑ‚ Ğ´Ğ¾Ğ¼ Ğ²Ğ°Ñˆ Ğ½Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑÑ‚ÑŒ." }
            },
            en: {
                ui: { title: "Blessed 2026", desc: "Enter name:", ph: "Name...", start: "Start ğŸ¤²", next: "Next âœˆï¸", share: "Share", download: "ğŸ“¸ Save", hint: "Open chest!", days: "d", hours: "h", mins: "m", secs: "s" },
                coming: { greet: "Dear {name}, may the Almighty grant you success and halal sustenance!", poem: "May Allah guide you day by day,\nKeep all troubles far away.\nIn the coming year so new,\nMay His blessings be with you." },
                arrived: { greet: "Dear {name}, may the Almighty fill your life with peace!", poem: "New year is here, bright and clear,\nMay faith in heart be ever near.\nGoodness, health, and halal wealth,\nJoy and peace and spiritual health." }
            },
            fr: {
                ui: { title: "BÃ©ni 2026", desc: "Nom:", ph: "Nom...", start: "DÃ©but", next: "Suivant", share: "Partager", download: "ğŸ“¸ TÃ©lÃ©charger", hint: "Ouvrir!", days: "j", hours: "h", mins: "m", secs: "s" },
                coming: { greet: "Cher {name}, qu'Allah vous accorde succÃ¨s et subsistance halal !", poem: "Qu'Allah Ã©claire votre chemin,\nEt vous protÃ¨ge chaque matin.\nQue cette annÃ©e soit un festin,\nDe paix et d'amour sans fin." },
                arrived: { greet: "Cher {name}, qu'Allah remplisse votre vie de paix !", poem: "Le nouvel an est arrivÃ©,\nQue votre foi soit prÃ©servÃ©e.\nBonheur, santÃ© et puretÃ©,\nPour toute l'Ã©ternitÃ©." }
            },
            de: {
                ui: { title: "Gesegnetes 2026", desc: "Name:", ph: "Name...", start: "Start", next: "Weiter", share: "Teilen", download: "ğŸ“¸ Laden", hint: "Ã–ffnen!", days: "T", hours: "Std", mins: "Min", secs: "Sek" },
                coming: { greet: "Lieber {name}, mÃ¶ge Allah dir im neuen Jahr Erfolg schenken!", poem: "MÃ¶ge Allah dich stets leiten,\nIn allen kommenden Zeiten.\nSegen sei in deinem Haus,\nFrieden tagein, tagaus." },
                arrived: { greet: "Lieber {name}, mÃ¶ge Allah dein Leben mit Frieden fÃ¼llen!", poem: "Das neue Jahr ist nun hier,\nGlaube sei stets bei dir.\nGesundheit und reines GlÃ¼ck,\nKein Blick mehr zurÃ¼ck." }
            },
            ar: {
                ui: { title: "2026 Ù…Ø¨Ø§Ø±Ùƒ", desc: "Ø§Ù„Ø§Ø³Ù…:", ph: "Ø§Ù„Ø§Ø³Ù…...", start: "Ø§Ø¨Ø¯Ø£", next: "Ø§Ù„ØªØ§Ù„ÙŠ", share: "Ù…Ø´Ø§Ø±ÙƒØ©", download: "ğŸ“¸ ØªØ­Ù…ÙŠÙ„", hint: "Ø§ÙØªØ­!", days: "ÙŠ", hours: "Ø³", mins: "Ø¯", secs: "Ø«" },
                coming: { greet: "Ø¹Ø²ÙŠØ²ÙŠ {name}ØŒ Ø£Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø£Ù† ÙŠØ±Ø²Ù‚Ùƒ Ø§Ù„Ø±Ø²Ù‚ Ø§Ù„Ø­Ù„Ø§Ù„!", poem: "ÙŠØ§ Ø±Ø¨ Ø¨Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯,\nÙˆØ§Ø¬Ø¹Ù„ Ø­ÙŠØ§Ø© {name} ÙÙŠ Ø¹ÙŠØ¯.\nØ¨Ø§Ù„Ø¥ÙŠÙ…Ø§Ù† ÙˆØ§Ù„ØªÙ‚ÙˆÙ‰ ØªØ²ÙŠØ¯,\nÙˆØ±Ø¶Ø§ Ø§Ù„Ø±Ø­Ù…Ù† Ù‡Ùˆ Ø§Ù„Ù…Ø²ÙŠØ¯." },
                arrived: { greet: "Ø¹Ø²ÙŠØ²ÙŠ {name}ØŒ Ø£Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø£Ù† ÙŠÙ…Ù„Ø£ Ø­ÙŠØ§ØªÙƒ Ø¨Ø§Ù„Ø¨Ø±ÙƒØ©!", poem: "Ø¹Ø§Ù… Ø¬Ø¯ÙŠØ¯ Ø£Ù‚Ø¨Ù„ Ø¹Ù„ÙŠÙ†Ø§,\nÙ†Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø§Ù„Ù„Ø·Ù ÙÙŠÙ†Ø§.\nØ§Ø±Ø²Ù‚Ù†Ø§ ÙŠØ§ Ø±Ø¨ Ø§Ù„Ø¬Ù†Ø§Ù†,\nÙˆØ§Ø­ÙØ¸Ù†Ø§ Ù…Ù† ÙƒÙ„ Ø´ÙŠØ·Ø§Ù†." }
            },
            zh: {
                ui: { title: "å‰ç¥¥ 2026", desc: "åå­—:", ph: "åå­—...", start: "å¼€å§‹", next: "ä¸‹ä¸€ä¸ª", share: "åˆ†äº«", download: "ğŸ“¸ ä¸‹è½½", hint: "æ‰“å¼€!", days: "å¤©", hours: "æ—¶", mins: "åˆ†", secs: "ç§’" },
                coming: { greet: "äº²çˆ±çš„ {name}ï¼Œæ„¿çœŸä¸»èµäºˆæ‚¨åˆæ³•çš„ç»™å…»ï¼", poem: "æ„¿çœŸä¸»èµç¦æ–°ä¸€å¹´,\nå¹³å®‰å–œä¹å¸¸ç›¸ä¼´.\næ­£é“å…‰èŠ’ç…§å¿ƒé—´,\nç”Ÿæ´»ç¾æ»¡ç¦æ— è¾¹." },
                arrived: { greet: "äº²çˆ±çš„ {name}ï¼Œæ„¿çœŸä¸»è®©æ‚¨çš„ç”Ÿæ´»å……æ»¡å¹³å®‰ï¼", poem: "æ–°å¹´å·²è‡³å–œæ°”æµ“,\nå¿ƒä¸­ä¿¡ä»°æ—¶åˆ»åŒ.\nå¥åº·è´¢å¯Œæºåˆæ³•,\nå¹¸ç¦å®‰åº·ä¼´ä¸€ç”Ÿ." }
            },
            ko: {
                ui: { title: "ì¶•ë³µë°›ì€ 2026", desc: "ì´ë¦„:", ph: "ì´ë¦„...", start: "ì‹œì‘", next: "ë‹¤ìŒ", share: "ê³µìœ ", download: "ğŸ“¸ ë‹¤ìš´ë¡œë“œ", hint: "ì—´ê¸°!", days: "ì¼", hours: "ì‹œ", mins: "ë¶„", secs: "ì´ˆ" },
                coming: { greet: "{name}ë‹˜, ìƒˆí•´ì—ëŠ” ì•Œë¼ì˜ ì¶•ë³µì´ ê°€ë“í•˜ì‹œê¸¸!", poem: "ì•Œë¼ê»˜ì„œ ê¸¸ì„ ë¹„ì¶”ì‹œê³ ,\nëª¨ë“  ê±±ì • ì‚¬ë¼ì§€ê²Œ í•˜ì†Œì„œ.\në‹¤ê°€ì˜¤ëŠ” ìƒˆí•´ì—ëŠ”,\nì¶•ë³µë§Œì´ ê°€ë“í•˜ê¸¸." },
                arrived: { greet: "{name}ë‹˜, ì•Œë¼ê»˜ì„œ í‰í™”ë¡œ ì±„ì›Œì£¼ì‹œê¸¸!", poem: "ìƒˆí•´ê°€ ë°ì•„ì™”ë„¤,\në¯¿ìŒì€ êµ³ê±´í•˜ë„¤.\nê±´ê°•ê³¼ í–‰ë³µì´,\në‹¹ì‹ ê³¼ í•¨ê»˜í•˜ê¸¸." }
            },
            ja: {
                ui: { title: "ç¥ç¦ã®2026", desc: "åå‰:", ph: "åå‰...", start: "é–‹å§‹", next: "æ¬¡ã¸", share: "å…±æœ‰", download: "ğŸ“¸ ä¿å­˜", hint: "é–‹ã‘ã‚‹!", days: "æ—¥", hours: "æ™‚", mins: "åˆ†", secs: "ç§’" },
                coming: { greet: "{name}ã•ã‚“ã€ã‚¢ãƒƒãƒ©ãƒ¼ã®ç¥ç¦ãŒã‚ã‚Šã¾ã™ã‚ˆã†ã«ï¼", poem: "ã‚¢ãƒƒãƒ©ãƒ¼ãŒå°ãçµ¦ã†,\næ‚©ã¿ã¯æ¶ˆãˆå»ã‚Šã¬.\næ¥ã‚‹ã¹ãæ–°å¹´ã«,\nå¹¸ã‚ã‚Œã¨ç¥ˆã‚‹." },
                arrived: { greet: "{name}ã•ã‚“ã€å¹³å®‰ãŒæº€ãŸã•ã‚Œã¾ã™ã‚ˆã†ã«ï¼", poem: "æ–°å¹´ãŒæ¥ãŸã‚Šã¦,\nä¿¡ä»°ã¯æ·±ã¾ã‚‹.\nå¥ã‚„ã‹ã§æ¸…ã‚‰ã‹ã«,\nå–œã³æº¢ã‚Œã‚‹æ—¥ã€…." }
            },
            es: {
                ui: { title: "Bendito 2026", desc: "Nombre:", ph: "Nombre...", start: "Iniciar", next: "Siguiente", share: "Compartir", download: "ğŸ“¸ Bajar", hint: "Â¡Abrir!", days: "d", hours: "h", mins: "m", secs: "s" },
                coming: { greet: "Querido {name}, Â¡que AlÃ¡ te conceda Ã©xito!", poem: "Que Allah guÃ­e tu caminar,\nY te aleje de todo mal.\nEn este aÃ±o que va a empezar,\nMucha paz te va a regalar." },
                arrived: { greet: "Querido {name}, Â¡que AlÃ¡ llene tu vida de paz!", poem: "El aÃ±o nuevo ya llegÃ³,\nLa fe en el alma floreciÃ³.\nSalud y paz en tu hogar,\nBendiciones sin cesar." }
            },
            mn: {
                ui: { title: "Ğ˜Ğ²ÑÑĞ»Ñ‚ 2026", desc: "ĞÑÑ€:", ph: "ĞÑÑ€...", start: "Ğ­Ñ…Ğ»ÑÑ…", next: "Ğ”Ğ°Ñ€Ğ°Ğ°Ñ…", share: "Ğ¥ÑƒĞ²Ğ°Ğ°Ğ»Ñ†Ğ°Ñ…", download: "ğŸ“¸ Ğ¢Ğ°Ñ‚Ğ°Ñ…", hint: "ĞÑÑÑ…!", days: "Ó©Ğ´Ó©Ñ€", hours: "Ñ†Ğ°Ğ³", mins: "Ğ¼Ğ¸Ğ½", secs: "ÑĞµĞº" },
                coming: { greet: "Ğ­Ñ€Ñ…ÑĞ¼ {name}, ĞĞ»Ğ»Ğ°Ñ… Ñ‚Ğ°Ğ½Ğ´ Ğ¸Ğ²ÑÑĞ»ÑÑ Ñ…Ğ°Ğ¹Ñ€Ğ»Ğ°Ğ³!", poem: "ĞĞ»Ğ»Ğ°Ñ… Ñ‚Ğ°Ğ½Ñ‹Ğ³ Ğ¸Ğ²ÑÑĞ³,\nĞ—Ğ¾Ğ²Ğ»Ğ¾Ğ½ Ğ±Ò¯Ñ…Ğ½Ğ¸Ğ¹Ğ³ Ğ¼Ğ°Ñ€Ñ‚ÑƒÑƒĞ»Ğ°Ğ³.\nĞ˜Ñ€Ğ¶ Ğ±ÑƒĞ¹ ÑˆĞ¸Ğ½Ñ Ğ¶Ğ¸Ğ»Ğ´,\nĞĞ· Ğ¶Ğ°Ñ€Ğ³Ğ°Ğ» Ğ´Ò¯Ò¯Ñ€ÑĞ½ Ğ±Ğ°Ğ¹Ğ³." },
                arrived: { greet: "Ğ­Ñ€Ñ…ÑĞ¼ {name}, ĞĞ»Ğ»Ğ°Ñ… Ñ‚Ğ°Ğ½Ñ‹ Ğ°Ğ¼ÑŒĞ´Ñ€Ğ°Ğ»Ñ‹Ğ³ Ğ°Ğ¼Ğ°Ñ€ Ğ°Ğ¼Ğ³Ğ°Ğ»Ğ°Ğ½ Ğ±Ğ¾Ğ»Ğ³Ğ¾Ğ³!", poem: "Ğ¨Ğ¸Ğ½Ñ Ğ¾Ğ½ Ğ¸Ñ€Ğ»ÑÑ,\nĞ¡Ò¯ÑÑĞ³ Ğ±Ğ¸ÑˆÑ€ÑĞ» Ğ½ÑĞ¼ÑĞ³Ğ´Ğ»ÑÑ.\nĞ­Ñ€Ò¯Ò¯Ğ» ÑĞ½Ñ…, ÑĞ°Ğ¹Ğ½ ÑĞ°Ğ¹Ñ…Ğ°Ğ½,\nÒ®Ò¯Ñ€Ğ´ Ğ¼Ó©Ğ½Ñ… Ğ±Ğ°Ğ¹Ğ³." }
            }
        };

        const destinations = [
            { name: "Astana ğŸ‡°ğŸ‡¿", coords: [51.16, 71.47], lang: "kk", timezone: "Asia/Almaty" },
            { name: "Moscow ğŸ‡·ğŸ‡º", coords: [55.75, 37.61], lang: "ru", timezone: "Europe/Moscow" },
            { name: "London ğŸ‡¬ğŸ‡§", coords: [51.50, -0.12], lang: "en", timezone: "Europe/London" },
            { name: "Paris ğŸ‡«ğŸ‡·", coords: [48.85, 2.35], lang: "fr", timezone: "Europe/Paris" },
            { name: "Berlin ğŸ‡©ğŸ‡ª", coords: [52.52, 13.40], lang: "de", timezone: "Europe/Berlin" },
            { name: "Mecca ğŸ‡¸ğŸ‡¦", coords: [21.38, 39.85], lang: "ar", timezone: "Asia/Riyadh" },
            { name: "Beijing ğŸ‡¨ğŸ‡³", coords: [39.90, 116.40], lang: "zh", timezone: "Asia/Shanghai" },
            { name: "Seoul ğŸ‡°ğŸ‡·", coords: [37.56, 126.97], lang: "ko", timezone: "Asia/Seoul" },
            { name: "Tokyo ğŸ‡¯ğŸ‡µ", coords: [35.67, 139.65], lang: "ja", timezone: "Asia/Tokyo" },
            { name: "Madrid ğŸ‡ªğŸ‡¸", coords: [40.41, -3.70], lang: "es", timezone: "Europe/Madrid" },
            { name: "Ulaanbaatar ğŸ‡²ğŸ‡³", coords: [47.91, 106.91], lang: "mn", timezone: "Asia/Ulaanbaatar" }
        ];

        let map, planeMarker, flightLine;
        let currentDestIndex = 0;
        let userName = "Ğ”Ğ¾ÑÑ‹Ğ¼";
        let isMusicPlaying = false;
        const audio = document.getElementById('bgMusic');

        window.onload = () => {
            initMap();
            setInterval(updateCountdown, 1000);
            updateCountdown();
            changeLanguage();
        };

        function initMap() {
            map = L.map('map', { zoomControl: false, dragging: true, touchZoom: true }).setView([40, 0], 2);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(map);
            const planeIcon = L.divIcon({ html: '<div class="plane-icon">âœˆï¸</div>', className: '', iconSize: [60, 60] });
            planeMarker = L.marker([51.16, 71.47], { icon: planeIcon }).addTo(map);
        }

        function startJourney() {
            const inputVal = document.getElementById('nameInput').value.trim();
            userName = inputVal || "Ğ”Ğ¾ÑÑ‹Ğ¼";
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('journeyScreen').classList.remove('hidden');
            toggleMusic();
            nextCity();
        }

        function nextCity() {
            currentDestIndex = (currentDestIndex + 1) % destinations.length;
            const city = destinations[currentDestIndex];
            flyToCity(city);
            updateCardContent(city);
            updateTime(city.timezone);
            confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
        }

        function flyToCity(city) {
            const old = planeMarker.getLatLng();
            const newLatLng = L.latLng(city.coords[0], city.coords[1]);
            map.flyTo(newLatLng, 5, { duration: 3 });
            planeMarker.setLatLng(newLatLng);
            if (flightLine) map.removeLayer(flightLine);
            flightLine = L.polyline([old, newLatLng], { color: '#FFD700', weight: 5, opacity: 0.8 }).addTo(map);
        }

        function updateCardContent(city) {
            const lang = city.lang;
            document.getElementById('uiLangSelect').value = lang;
            const t = translations[lang];
            const now = new Date().getTime();
            const data = (now >= targetDate) ? t.arrived : t.coming;

            document.getElementById('cityName').textContent = city.name;
            document.getElementById('greetingMsg').innerHTML = data.greet.replace("{name}", `<b style="color:#FFD700">${userName}</b>`);
            document.getElementById('poemBox').textContent = data.poem;
            document.getElementById('btnNext').textContent = t.ui.next;
        }

        function updateTime(timezone) {
            const now = new Date();
            const options = { timeZone: timezone, hour: '2-digit', minute: '2-digit', hour12: false };
            const timeStr = new Intl.DateTimeFormat('kk', options).format(now);
            document.getElementById('timeInfo').textContent = `ÒšĞ°Ğ·Ñ–Ñ€ ${destinations[currentDestIndex].name} ÑĞ°Ò“Ğ°Ñ‚: ${timeStr}`;
        }

        function changeLanguage() {
            const lang = document.getElementById('uiLangSelect').value;
            const t = translations[lang].ui;

            document.querySelector('#loginScreen h1').textContent = t.title;
            document.getElementById('appDesc').textContent = t.desc;
            document.getElementById('nameInput').placeholder = t.ph;
            document.getElementById('btnStart').textContent = t.start;
            document.getElementById('chestHint').textContent = t.hint;
            document.getElementById('btnNext').textContent = t.next;
            document.getElementById('btnShare').textContent = t.share;
            document.getElementById('btnDownload').textContent = t.download;

            if (!document.getElementById('contentWrapper').classList.contains('hidden')) {
                updateCardContent(destinations[currentDestIndex]);
            }
            updateTime(destinations[currentDestIndex].timezone);
        }

        function toggleMusic() {
            if (isMusicPlaying) {
                audio.pause();
                isMusicPlaying = false;
                document.getElementById('musicBtn').textContent = "ğŸ”‡";
            } else {
                audio.play().catch(() => {});
                isMusicPlaying = true;
                document.getElementById('musicBtn').textContent = "ğŸµ";
            }
        }

        function openChest() {
            confetti({ particleCount: 300, spread: 100, origin: { y: 0.6 } });
            document.getElementById('chestWrapper').style.display = 'none';
            document.getElementById('contentWrapper').classList.remove('hidden');
            document.getElementById('controlButtons').classList.remove('hidden');
            updateCardContent(destinations[currentDestIndex]);
            updateTime(destinations[currentDestIndex].timezone);
        }

        function updateCountdown() {
            const now = new Date().getTime();
            const distance = targetDate - now;
            const lang = document.getElementById('uiLangSelect').value || 'kk';
            const t = translations[lang].ui;

            if (distance < 0) {
                document.getElementById('loginCountdown').textContent = "ğŸ‰ 2026 Ğ–Ñ‹Ğ» ĞšĞµĞ»Ğ´Ñ–!";
                document.getElementById('mainCountdown').textContent = "ğŸ‰ 2026 Ğ–Ñ‹Ğ» ĞšĞµĞ»Ğ´Ñ–!";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            const timeStr = `${days}${t.days} ${hours}${t.hours} ${minutes}${t.mins} ${seconds}${t.secs}`;
            document.getElementById('loginCountdown').textContent = timeStr;
            document.getElementById('mainCountdown').textContent = timeStr;
        }

        function shareGreeting() {
            if (navigator.share) {
                navigator.share({ title: '2026 ÒšÒ±Ñ‚Ñ‚Ñ‹Ò›Ñ‚Ğ°Ñƒ', url: window.location.href });
            } else {
                navigator.clipboard.writeText(window.location.href);
                alert("Ğ¡Ñ–Ğ»Ñ‚ĞµĞ¼Ğµ ĞºÓ©ÑˆÑ–Ñ€Ñ–Ğ»Ğ´Ñ–!");
            }
        }

        function downloadCard() {
            html2canvas(document.getElementById('captureArea'), { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = '2026_greeting.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }
    </script>
</body>
</html>
