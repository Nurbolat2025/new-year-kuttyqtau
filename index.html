–ë“±–ª –∫–µ—Ä–µ–º–µ—Ç –∏–¥–µ—è! –ñ–æ–±–∞–Ω—ã –∂–∞“£–∞ –¥–µ“£–≥–µ–π–≥–µ –∫”©—Ç–µ—Ä–µ—Ç—ñ–Ω ”©–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä.
–°—ñ–∑–¥—ñ“£ —Å“±—Ä–∞–Ω—ã—Å—ã“£—ã–∑ –±–æ–π—ã–Ω—à–∞ –µ–∫—ñ –º–∞“£—ã–∑–¥—ã –∂–∞“£–∞—Ä—Ç—É –∂–∞—Å–∞–¥—ã–º:
 * üì± –°–º–∞—Ä—Ç—Ñ–æ–Ω“ì–∞ –±–µ–π—ñ–º–¥–µ—É (–ê–¥–∞–ø—Ç–∞—Ü–∏—è):
   * –¢–µ–ª–µ—Ñ–æ–Ω–º–µ–Ω –∞—à“õ–∞–Ω–¥–∞ –∫–∞—Ä—Ç–∞ –º–µ–Ω –º”ô—Ç—ñ–Ω —Å—ã–π–º–∞–π “õ–∞–ª–∞—Ç—ã–Ω –º”ô—Å–µ–ª–µ —à–µ—à—ñ–ª–¥—ñ.
   * –ï–Ω–¥—ñ –∫–∞—Ä—Ç–∞ —ç–∫—Ä–∞–Ω–Ω—ã“£ –∂–æ“ì–∞—Ä“ì—ã 35%, –∞–ª –º”ô—Ç—ñ–Ω –±”©–ª—ñ–≥—ñ —Ç”©–º–µ–Ω–≥—ñ 65% –∞–ª–∞–¥—ã.
   * –®—Ä–∏—Ñ—Ç—Ç–µ—Ä –º–µ–Ω –±–∞—Ç—ã—Ä–º–∞–ª–∞—Ä —Ç–µ–ª–µ—Ñ–æ–Ω —ç–∫—Ä–∞–Ω—ã–Ω–∞ —ã“£“ì–∞–π–ª—ã –µ—Ç—ñ–ø –∫—ñ—à—ñ—Ä–µ–π—Ç—ñ–ª–¥—ñ.
 * üó£Ô∏è –î—ã–±—ã—Å—Ç—ã“õ –æ“õ—É (Text-to-Speech):
   * –ú—É–∑—ã–∫–∞–Ω—ã“£ –æ—Ä–Ω—ã–Ω–∞ –µ–Ω–¥—ñ "–î–∞—É—ã—Å" (Speaker) —Ñ—É–Ω–∫—Ü–∏—è—Å—ã “õ–æ—Å—ã–ª–¥—ã.
   * –°—ñ–∑ “õ–∞–π —Ç—ñ–ª–¥—ñ —Ç–∞“£–¥–∞—Å–∞“£—ã–∑ (–Ω–µ–º–µ—Å–µ “õ–∞–π –µ–ª–≥–µ “±—à—Å–∞“£—ã–∑), —Ç–µ–ª–µ—Ñ–æ–Ω —Å–æ–ª —Ç—ñ–ª–¥–µ–≥—ñ ”©–ª–µ“£–¥—ñ –¥–∞—É—ã—Å—Ç–∞–ø –æ“õ—ã–ø –±–µ—Ä–µ–¥—ñ (–ë“±–ª —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã“£ ”©–∑ –∂“Ø–π–µ—Å—ñ–Ω–¥–µ–≥—ñ –¥–∞—É—ã—Å—Ç–∞—Ä–¥—ã “õ–æ–ª–¥–∞–Ω–∞–¥—ã).
   * –ï—Å–∫–µ—Ä—Ç—É: “ö–∞–∑–∞“õ —Ç—ñ–ª—ñ–Ω–¥–µ–≥—ñ –¥–∞—É—ã—Å –∫–µ–π–±—ñ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–¥–∞—Ä–¥–∞ (–µ–≥–µ—Ä “õ–∞–∑–∞“õ —Ç—ñ–ª—ñ –∂“Ø–π–µ–ª—ñ–∫ –¥–µ“£–≥–µ–π–¥–µ –æ—Ä–Ω–∞—Ç—ã–ª–º–∞“ì–∞–Ω –±–æ–ª—Å–∞) –æ“õ—ã–ª–º–∞—É—ã –º“Ø–º–∫—ñ–Ω, –±—ñ—Ä–∞“õ –∞“ì—ã–ª—à—ã–Ω, –æ—Ä—ã—Å, —Ç“Ø—Ä—ñ–∫ —Ç.–±. —Ç—ñ–ª–¥–µ—Ä –∞–Ω—ã“õ –æ“õ—ã–ª–∞–¥—ã.
–ú—ñ–Ω–µ, —Ç–æ–ª—ã“õ –∂–∞“£–∞—Ä—Ç—ã–ª“ì–∞–Ω –∫–æ–¥. index.html-–≥–µ —Ç“Ø–≥–µ–ª –∫”©—à—ñ—Ä—ñ–ø –∞–ª—ã“£—ã–∑:
<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global 2026 Greeting</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d47a1">
    <link rel="icon" type="image/png" href="icon-192.png">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        body { margin: 0; padding: 0; height: 100vh; display: flex; font-family: 'Segoe UI', Tahoma, sans-serif; overflow: hidden; background: #1a1a1a; color: white; }

        /* --- –°–û–õ –ñ–ê“ö (–ö–ê–†–¢–ê) --- */
        #map-container { width: 60%; height: 100%; position: relative; }
        #map { width: 100%; height: 100%; z-index: 1; }
        
        /* --- –û“¢ –ñ–ê“ö (–ü–ê–ù–ï–õ–¨) --- */
        #sidebar {
            width: 40%; height: 100%;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 10px; box-shadow: -5px 0 15px rgba(0,0,0,0.5); z-index: 2; overflow-y: auto;
        }

        /* --- –ñ–û“í–ê–†“í–´ –ú”ò–ó–Ü–† --- */
        .top-controls { position: absolute; top: 15px; right: 15px; z-index: 1000; display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end; width: 85%; pointer-events: none; }
        .top-controls > * { pointer-events: auto; }
        
        .icon-btn { background: rgba(0,0,0,0.6); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s;}
        .icon-btn.speaking { background: #4CAF50; animation: pulse 1.5s infinite; }
        .lang-select { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 5px 10px; font-weight: bold; border: none; cursor: pointer; outline: none; box-shadow: 0 2px 10px rgba(0,0,0,0.3); font-size: 14px; }

        h1 { color: #FFD700; text-shadow: 0 0 10px #FF8C00; font-size: 1.5rem; margin-bottom: 15px; text-align: center; line-height: 1.2;}
        
        .countdown-box { font-family: 'Courier New', monospace; background: rgba(0, 255, 255, 0.1); color: #84ffff; padding: 8px; border-radius: 10px; margin: 8px 0; font-size: 1rem; border: 1px solid rgba(132, 255, 255, 0.3); text-shadow: 0 0 5px #84ffff; width: 95%; text-align: center; }
        
        .chest-wrapper { margin: 15px 0; cursor: pointer; animation: float 3s ease-in-out infinite; text-align: center;}
        .chest-icon { font-size: 70px; filter: drop-shadow(0 0 20px gold); }
        .chest-hint { font-size: 0.8rem; color: #aaa; margin-top: 5px; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); } 100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); } }

        .card-content { background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 15px; width: 95%; text-align: center; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.1); box-sizing: border-box;}
        .city-name { font-size: 1.5rem; color: #4DD0E1; margin: 5px 0; text-shadow: 2px 2px 4px black; }
        .greeting-text { font-size: 1rem; line-height: 1.4; color: #fff; margin: 10px 0; }
        
        .poem-box { background: rgba(0, 40, 0, 0.6); padding: 10px; border-radius: 10px; margin: 10px 0; border-left: 3px solid #FFD700; font-style: italic; white-space: pre-line; color: #fffde7; font-size: 0.95rem; line-height: 1.5; text-shadow: 1px 1px 2px black; border: 1px solid rgba(255, 215, 0, 0.2); }

        input { width: 85%; padding: 12px; margin: 10px 0; border-radius: 12px; border: none; text-align: center; font-size: 16px; }
        .main-btn { width: 100%; padding: 12px; margin: 5px 0; border-radius: 12px; border: none; font-size: 15px; font-weight: bold; background: linear-gradient(135deg, #FFD700 0%, #FFA000 100%); color: #000; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.2s; }
        .main-btn:active { transform: scale(0.95); }
        .share-btn { background: linear-gradient(135deg, #eee 0%, #ccc 100%); color: #333; }
        .download-btn { background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); color: white; }
        .confirm-btn { background: #4CAF50; color: white; width: 45%; margin: 5px;}
        .deny-btn { background: #F44336; color: white; width: 45%; margin: 5px;}

        .hidden { display: none !important; }
        .plane-icon { font-size: 40px; text-shadow: 0 0 10px black; transition: all 1s ease-in-out; }

        /* --- –°–ú–ê–†–¢–§–û–ù“í–ê –ê–†–ù–ê–õ“í–ê–ù –°–¢–ò–õ–¨–î–ï–† --- */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            #map-container { width: 100%; height: 35vh; } /* –ö–∞—Ä—Ç–∞ –±–∏—ñ–∫—Ç—ñ–≥—ñ 35% */
            #sidebar { width: 100%; height: 65vh; box-shadow: 0 -5px 15px rgba(0,0,0,0.5); padding: 15px 5px; } /* –ú”ô—Ç—ñ–Ω –±–∏—ñ–∫—Ç—ñ–≥—ñ 65% */
            h1 { font-size: 1.3rem; margin: 5px 0; }
            .city-name { font-size: 1.3rem; }
            .greeting-text { font-size: 0.9rem; }
            .poem-box { font-size: 0.9rem; padding: 8px; }
            .main-btn { padding: 10px; font-size: 14px; }
            .chest-icon { font-size: 60px; }
            #stats-container { transform: scale(0.8) translateX(-60%); bottom: 5px; }
        }
    </style>
</head>
<body>

    <div id="map-container">
        <div id="map"></div>
        <div class="top-controls">
            <button id="voiceBtn" class="icon-btn" onclick="toggleVoice()" title="–î–∞—É—ã—Å">üîá</button>
            <select id="uiLangSelect" class="lang-select" onchange="changeLanguage()">
                <option value="kk">üá∞üáø “ö–∞–∑–∞“õ</option>
                <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                <option value="en">üá∫üá∏ English</option>
                <option value="fr">üá´üá∑ Fran√ßais</option>
                <option value="de">üá©üá™ Deutsch</option>
                <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                <option value="es">üá™üá∏ Espa√±ol</option>
                <option value="mn">üá≤üá≥ –ú–æ–Ω–≥–æ–ª</option>
            </select>
        </div>
    </div>

    <div id="sidebar">
        <div id="loginScreen" style="width: 100%; text-align: center;">
            <h1>üåô –ë–µ—Ä–µ–∫–µ–ª—ñ 2026</h1>
            <div id="loginCountdown" class="countdown-box">–ñ“Ø–∫—Ç–µ–ª—É–¥–µ...</div>
            <p id="appDesc" style="font-size: 0.9rem; color: #ccc;">–ê–¥–∞–ª –Ω–∏–µ—Ç–ø–µ–Ω “õ“±—Ç—Ç—ã“õ—Ç–∞—É –∂–æ–ª–¥–∞“£—ã–∑!</p>
            
            <div id="confirmNameBlock" class="hidden" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px; margin-top: 10px;">
                <p id="confirmQuestion" style="font-size: 1rem; margin-bottom: 10px;">–°—ñ–∑–¥—ñ“£ –∞—Ç—ã“£—ã–∑ <b id="detectedName" style="color: #FFD700;"></b> –±–∞?</p>
                <div style="display: flex; justify-content: center;">
                    <button onclick="confirmNameYes()" class="main-btn confirm-btn" id="btnYes">–ò”ô ‚úÖ</button>
                    <button onclick="confirmNameNo()" class="main-btn deny-btn" id="btnNo">–ñ–æ“õ ‚ùå</button>
                </div>
            </div>

            <div id="inputNameBlock">
                <input type="text" id="nameInput" placeholder="–ï—Å—ñ–º—ñ“£—ñ–∑...">
                <div id="errorMsg" style="color: #FF5252; display: none; font-size: 0.8em; margin-top: 5px;"></div>
                <button onclick="startJourney()" class="main-btn" id="btnStart">–ë–∞—Å—Ç–∞—É ü§≤</button>
            </div>
        </div>

        <div id="journeyScreen" class="hidden" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
            <div id="captureArea" class="card-content">
                <div id="mainCountdown" class="countdown-box" style="margin: 0 auto 10px auto;"></div>
                
                <div id="chestWrapper" class="chest-wrapper" onclick="openChest()">
                    <div class="chest-icon">üéÅ</div>
                    <div class="chest-hint" id="chestHint">–°—ã–π–ª—ã“õ—Ç—ã –∞—à—É “Ø—à—ñ–Ω –±–∞—Å—ã“£—ã–∑!</div>
                </div>

                <div id="contentWrapper" class="hidden">
                    <h2 id="cityName" class="city-name">City</h2>
                    <div id="greetingMsg" class="greeting-text">...</div>
                    <div id="poemBox" class="poem-box">...</div>
                </div>
            </div>
            
            <div id="controlButtons" class="hidden" style="width: 100%;">
                <button onclick="downloadCard()" class="main-btn download-btn" id="btnDownload">üì∏ –°—É—Ä–µ—Ç —Ä–µ—Ç—ñ–Ω–¥–µ –∂“Ø–∫—Ç–µ—É</button>
                <button onclick="nextCity()" class="main-btn" id="btnNext">–ö–µ–ª–µ—Å—ñ –µ–ª ‚úàÔ∏è</button>
                <button onclick="shareGreeting()" class="main-btn share-btn" id="btnShare">–ë”©–ª—ñ—Å—É üîó</button>
            </div>
        </div>

        <div id="stats-container" style="margin-top: 15px; opacity: 0.7;">
            <a href="https://info.flagcounter.com/YourNewID" target="_blank">
                <img src="https://s11.flagcounter.com/count2/p2x2/bg_000000/txt_FFFFFF/border_CCCCCC/columns_4/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/percent_0/" alt="Flag Counter" border="0" style="height: 40px;">
            </a>
        </div>
    </div>

    <script>
        const targetDate = new Date("January 1, 2026 00:00:00").getTime();

        // 11 –¢–Ü–õ, –®–ê–†–ò“í–ê–¢“ö–ê –°–ê–ô ”®–õ–ï“¢–î–ï–† + TTS Codes (BCP 47 tags)
        const translations = {
            kk: {
                tts: 'kk-KZ', // Text-to-Speech Code
                ui: { title: "–ë–µ—Ä–µ–∫–µ–ª—ñ 2026 –ñ—ã–ª", desc: "–ê—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑:", ph: "–ê—Ç—ã“£—ã–∑...", start: "–ë–∞—Å—Ç–∞—É ü§≤", next: "–ö–µ–ª–µ—Å—ñ –µ–ª ‚úàÔ∏è", share: "–ë”©–ª—ñ—Å—É üîó", download: "üì∏ –û—Ç–∫—Ä—ã—Ç–∫–∞ –∂“Ø–∫—Ç–µ—É", hint: "–°—ã–π–ª—ã“õ—Ç—ã –∞—à—É! üéÅ", days: "–∫“Ø–Ω", hours: "—Å–∞“ì", mins: "–º–∏–Ω", secs: "—Å–µ–∫", err_char: "–ê—Ç—Ç–∞ “õ–∞—Ç–µ –±–∞—Ä.", err_rep: "”ò—Ä—ñ–ø “õ–∞–π—Ç–∞–ª–∞–Ω–¥—ã.", conf_q: "–°—ñ–∑ {name}—Å—ñ–∑ –±–µ?", yes: "–ò”ô", no: "–ñ–æ“õ" },
                coming: { greet: "“ö“±—Ä–º–µ—Ç—Ç—ñ {name}, –∫–µ–ª–µ –∂–∞—Ç“õ–∞–Ω –ñ–∞“£–∞ –∂—ã–ª–¥–∞ –ê–ª–ª–∞ –¢–∞“ì–∞–ª–∞ –µ–∫—ñ –¥“Ø–Ω–∏–µ–Ω—ñ“£ –∂–∞“õ—Å—ã–ª—ã“ì—ã–Ω –Ω”ô—Å—ñ–ø –µ—Ç—Å—ñ–Ω!", poem: "–ê–ª–ª–∞ “õ–æ–ª–¥–∞–ø ”ô—Ä —ñ—Å—ñ“£–¥—ñ –æ“£ “õ—ã–ª—Å—ã–Ω,\n–†–∏–∑—ã“õ-–Ω–µ—Å—ñ–±–µ“£ –∞–¥–∞–ª—ã–Ω–∞–Ω –º–æ–ª –±–æ–ª—Å—ã–Ω.\n–ö–µ–ª–µ –∂–∞—Ç“õ–∞–Ω –∂—ã–ª–¥–∞ –±”ô—Ä—ñ –∂–∞“£–∞—Ä—ã–ø,\n–ò–º–∞–Ω—ã“£—ã–∑ –Ω“±—Ä“ì–∞ —Ç–æ–ª–∞—Ä –∂—ã–ª –±–æ–ª—Å—ã–Ω!" },
                arrived: { greet: "“ö“±—Ä–º–µ—Ç—Ç—ñ {name}, –ñ–∞“£–∞ –∂—ã–ª–¥–∞ –ê–ª–ª–∞ ”ô—Ä–±—ñ—Ä –∫“Ø–Ω—ñ“£—ñ–∑–≥–µ –±–µ—Ä–µ–∫–µ –±–µ—Ä—Å—ñ–Ω!", poem: "–ñ–∞“£–∞ –∂—ã–ª–¥–∞ –∂–∞“õ—Å—ã–ª—ã“õ—Ç–∞—Ä –∫”©–ø –±–æ–ª—Å—ã–Ω,\n–£–∞–π—ã–º-“õ–∞–π“ì—ã –µ—à“õ–∞—à–∞–Ω–¥–∞ –∂–æ“õ –±–æ–ª—Å—ã–Ω.\n–ê–ª–ª–∞ –±–µ—Ä–≥–µ–Ω “ì“±–º—ã—Ä—ã“£—ã–∑ –º”ô–Ω–¥—ñ –±–æ–ø,\n–î–∞—Å—Ç–∞—Ä—Ö–∞–Ω—ã“£ –∞–¥–∞–ª –∞—Å“õ–∞ –ª—ã“õ —Ç–æ–ª—Å—ã–Ω!" }
            },
            ru: {
                tts: 'ru-RU',
                ui: { title: "–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω—ã–π 2026", desc: "–í–≤–µ–¥–∏—Ç–µ –∏–º—è:", ph: "–í–∞—à–µ –∏–º—è...", start: "–û—Ç–∫—Ä—ã—Ç—å ü§≤", next: "–î–∞–ª–µ–µ ‚úàÔ∏è", share: "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è", download: "üì∏ –°–∫–∞—á–∞—Ç—å", hint: "–û—Ç–∫—Ä–æ–π—Ç–µ —Å—É–Ω–¥—É–∫!", days: "–¥", hours: "—á", mins: "–º", secs: "—Å", err_char: "–û—à–∏–±–∫–∞ –≤ –∏–º–µ–Ω–∏.", err_rep: "–ü–æ–≤—Ç–æ—Ä –±—É–∫–≤.", conf_q: "–í–∞—Å –∑–æ–≤—É—Ç {name}?", yes: "–î–∞", no: "–ù–µ—Ç" },
                coming: { greet: "–£–≤–∞–∂–∞–µ–º—ã–π {name}, –ø—É—Å—Ç—å –í—Å–µ–≤—ã—à–Ω–∏–π –¥–∞—Ä—É–µ—Ç –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ –≤ –Ω–æ–≤–æ–º –≥–æ–¥—É!", poem: "–ü—É—Å—Ç—å –ê–ª–ª–∞—Ö —Ö—Ä–∞–Ω–∏—Ç –æ—Ç –±–µ–¥,\n–î–∞—Ä–∏—Ç –º—É–¥—Ä–æ—Å—Ç—å –∏ —Å–æ–≤–µ—Ç.\n–í –Ω–∞—Å—Ç—É–ø–∞—é—â–µ–º –≥–æ–¥—É,\n–û—Ç–≤–æ–¥–∏—Ç –≥–æ—Ä–µ –∏ –±–µ–¥—É." },
                arrived: { greet: "–£–≤–∞–∂–∞–µ–º—ã–π {name}, –ø—É—Å—Ç—å –í—Å–µ–≤—ã—à–Ω–∏–π –Ω–∞–ø–æ–ª–Ω–∏—Ç –¥–æ–º –±–∞—Ä–∞–∫–∞—Ç–æ–º!", poem: "–ì–æ–¥ –ø—Ä–∏—à–µ–ª, —Ö–≤–∞–ª–∞ –¢–≤–æ—Ä—Ü—É,\n–°—á–∞—Å—Ç—å–µ –ø—É—Å—Ç—å –ø—Ä–∏–¥–µ—Ç –∫ –ª–∏—Ü—É.\n–ú–∏—Ä, –ø–æ–∫–æ–π –∏ –±–ª–∞–≥–æ–¥–∞—Ç—å,\n–ë—É–¥—É—Ç –¥–æ–º –≤–∞—à –Ω–∞–ø–æ–ª–Ω—è—Ç—å." }
            },
            en: {
                tts: 'en-US',
                ui: { title: "Blessed 2026", desc: "Enter name:", ph: "Name...", start: "Start ü§≤", next: "Next ‚úàÔ∏è", share: "Share", download: "üì∏ Save", hint: "Open chest!", days: "d", hours: "h", mins: "m", secs: "s", err_char: "Invalid name.", err_rep: "Repeated.", conf_q: "Are you {name}?", yes: "Yes", no: "No" },
                coming: { greet: "Dear {name}, may the Almighty grant you success and halal sustenance!", poem: "May Allah guide you day by day,\nKeep all troubles far away.\nIn the coming year so new,\nMay His blessings be with you." },
                arrived: { greet: "Dear {name}, may the Almighty fill your life with peace!", poem: "New year is here, bright and clear,\nMay faith in heart be ever near.\nGoodness, health, and halal wealth,\nJoy and peace and spiritual health." }
            },
            fr: {
                tts: 'fr-FR',
                ui: { title: "B√©ni 2026", desc: "Nom:", ph: "Nom...", start: "D√©but", next: "Suivant", share: "Partager", download: "üì∏ T√©l√©charger", hint: "Ouvrir!", days: "j", hours: "h", mins: "m", secs: "s", err_char: "Erreur nom.", err_rep: "R√©p√©tition.", conf_q: "√ätes-vous {name}?", yes: "Oui", no: "Non" },
                coming: { greet: "Cher {name}, qu'Allah vous accorde succ√®s et subsistance halal !", poem: "Qu'Allah √©claire votre chemin,\nEt vous prot√®ge chaque matin.\nQue cette ann√©e soit un festin,\nDe paix et d'amour sans fin." },
                arrived: { greet: "Cher {name}, qu'Allah remplisse votre vie de paix !", poem: "Le nouvel an est arriv√©,\nQue votre foi soit pr√©serv√©e.\nBonheur, sant√© et puret√©,\nPour toute l'√©ternit√©." }
            },
            de: {
                tts: 'de-DE',
                ui: { title: "Gesegnetes 2026", desc: "Name:", ph: "Name...", start: "Start", next: "Weiter", share: "Teilen", download: "üì∏ Laden", hint: "√ñffnen!", days: "T", hours: "Std", mins: "Min", secs: "Sek", err_char: "Fehler.", err_rep: "Wiederholung.", conf_q: "Bist du {name}?", yes: "Ja", no: "Nein" },
                coming: { greet: "Lieber {name}, m√∂ge Allah dir im neuen Jahr Erfolg schenken!", poem: "M√∂ge Allah dich stets leiten,\nIn allen kommenden Zeiten.\nSegen sei in deinem Haus,\nFrieden tagein, tagaus." },
                arrived: { greet: "Lieber {name}, m√∂ge Allah dein Leben mit Frieden f√ºllen!", poem: "Das neue Jahr ist nun hier,\nGlaube sei stets bei dir.\nGesundheit und reines Gl√ºck,\nKein Blick mehr zur√ºck." }
            },
            ar: {
                tts: 'ar-SA',
                ui: { title: "2026 ŸÖÿ®ÿßÿ±ŸÉ", desc: "ÿßŸÑÿßÿ≥ŸÖ:", ph: "ÿßŸÑÿßÿ≥ŸÖ...", start: "ÿßÿ®ÿØÿ£", next: "ÿßŸÑÿ™ÿßŸÑŸä", share: "ŸÖÿ¥ÿßÿ±ŸÉÿ©", download: "üì∏ ÿ™ÿ≠ŸÖŸäŸÑ", hint: "ÿßŸÅÿ™ÿ≠!", days: "Ÿä", hours: "ÿ≥", mins: "ÿØ", secs: "ÿ´", err_char: "ÿÆÿ∑ÿ£.", err_rep: "ÿ™ŸÉÿ±ÿßÿ±.", conf_q: "ŸáŸÑ ÿ£ŸÜÿ™ {name}ÿü", yes: "ŸÜÿπŸÖ", no: "ŸÑÿß" },
                coming: { greet: "ÿπÿ≤Ÿäÿ≤Ÿä {name}ÿå ÿ£ÿ≥ÿ£ŸÑ ÿßŸÑŸÑŸá ÿ£ŸÜ Ÿäÿ±ÿ≤ŸÇŸÉ ÿßŸÑÿ±ÿ≤ŸÇ ÿßŸÑÿ≠ŸÑÿßŸÑ!", poem: "Ÿäÿß ÿ±ÿ® ÿ®ÿßÿ±ŸÉ ŸÅŸä ÿßŸÑÿπÿßŸÖ ÿßŸÑÿ¨ÿØŸäÿØÿå\nŸàÿßÿ¨ÿπŸÑ ÿ≠Ÿäÿßÿ© {name} ŸÅŸä ÿπŸäÿØ.\nÿ®ÿßŸÑÿ•ŸäŸÖÿßŸÜ ŸàÿßŸÑÿ™ŸÇŸàŸâ ÿ™ÿ≤ŸäÿØÿå\nŸàÿ±ÿ∂ÿß ÿßŸÑÿ±ÿ≠ŸÖŸÜ ŸáŸà ÿßŸÑŸÖÿ≤ŸäÿØ." },
                arrived: { greet: "ÿπÿ≤Ÿäÿ≤Ÿä {name}ÿå ÿ£ÿ≥ÿ£ŸÑ ÿßŸÑŸÑŸá ÿ£ŸÜ ŸäŸÖŸÑÿ£ ÿ≠Ÿäÿßÿ™ŸÉ ÿ®ÿßŸÑÿ®ÿ±ŸÉÿ©!", poem: "ÿπÿßŸÖ ÿ¨ÿØŸäÿØ ÿ£ŸÇÿ®ŸÑ ÿπŸÑŸäŸÜÿßÿå\nŸÜÿ≥ÿ£ŸÑ ÿßŸÑŸÑŸá ÿßŸÑŸÑÿ∑ŸÅ ŸÅŸäŸÜÿß.\nÿßÿ±ÿ≤ŸÇŸÜÿß Ÿäÿß ÿ±ÿ® ÿßŸÑÿ¨ŸÜÿßŸÜÿå\nŸàÿßÿ≠ŸÅÿ∏ŸÜÿß ŸÖŸÜ ŸÉŸÑ ÿ¥Ÿäÿ∑ÿßŸÜ." }
            },
            zh: {
                tts: 'zh-CN',
                ui: { title: "ÂêâÁ•• 2026", desc: "ÂêçÂ≠ó:", ph: "ÂêçÂ≠ó...", start: "ÂºÄÂßã", next: "‰∏ã‰∏Ä‰∏™", share: "ÂàÜ‰∫´", download: "üì∏ ‰∏ãËΩΩ", hint: "ÊâìÂºÄ!", days: "Â§©", hours: "Êó∂", mins: "ÂàÜ", secs: "Áßí", err_char: "ÈîôËØØ", err_rep: "ÈáçÂ§ç", conf_q: "ÊòØ {name} Âêó?", yes: "ÊòØ", no: "‰∏ç" },
                coming: { greet: "‰∫≤Áà±ÁöÑ {name}ÔºåÊÑøÁúü‰∏ªËµê‰∫àÊÇ®ÂêàÊ≥ïÁöÑÁªôÂÖªÔºÅ", poem: "ÊÑøÁúü‰∏ªËµêÁ¶èÊñ∞‰∏ÄÂπ¥Ôºå\nÂπ≥ÂÆâÂñú‰πêÂ∏∏Áõ∏‰º¥„ÄÇ\nÊ≠£ÈÅìÂÖâËäíÁÖßÂøÉÈó¥Ôºå\nÁîüÊ¥ªÁæéÊª°Á¶èÊó†Ëæπ„ÄÇ" },
                arrived: { greet: "‰∫≤Áà±ÁöÑ {name}ÔºåÊÑøÁúü‰∏ªËÆ©ÊÇ®ÁöÑÁîüÊ¥ªÂÖÖÊª°Âπ≥ÂÆâÔºÅ", poem: "Êñ∞Âπ¥Â∑≤Ëá≥ÂñúÊ∞îÊµìÔºå\nÂøÉ‰∏≠‰ø°‰ª∞Êó∂ÂàªÂêå„ÄÇ\nÂÅ•Â∫∑Ë¥¢ÂØåÊ∫êÂêàÊ≥ïÔºå\nÂπ∏Á¶èÂÆâÂ∫∑‰º¥‰∏ÄÁîü„ÄÇ" }
            },
            ko: {
                tts: 'ko-KR',
                ui: { title: "Ï∂ïÎ≥µÎ∞õÏùÄ 2026", desc: "Ïù¥Î¶Ñ:", ph: "Ïù¥Î¶Ñ...", start: "ÏãúÏûë", next: "Îã§Ïùå", share: "Í≥µÏú†", download: "üì∏ Îã§Ïö¥Î°úÎìú", hint: "Ïó¥Í∏∞!", days: "Ïùº", hours: "Ïãú", mins: "Î∂Ñ", secs: "Ï¥à", err_char: "Ïò§Î•ò.", err_rep: "Î∞òÎ≥µ.", conf_q: "{name} Îãò?", yes: "ÎÑ§", no: "ÏïÑÎãàÏöî" },
                coming: { greet: "{name}Îãò, ÏÉàÌï¥ÏóêÎäî ÏïåÎùºÏùò Ï∂ïÎ≥µÏù¥ Í∞ÄÎìùÌïòÏãúÍ∏∏!", poem: "ÏïåÎùºÍªòÏÑú Í∏∏ÏùÑ ÎπÑÏ∂îÏãúÍ≥†,\nÎ™®Îì† Í±±Ï†ï ÏÇ¨ÎùºÏßÄÍ≤å ÌïòÏÜåÏÑú.\nÎã§Í∞ÄÏò§Îäî ÏÉàÌï¥ÏóêÎäî,\nÏ∂ïÎ≥µÎßåÏù¥ Í∞ÄÎìùÌïòÍ∏∏." },
                arrived: { greet: "{name}Îãò, ÏïåÎùºÍªòÏÑú ÌèâÌôîÎ°ú Ï±ÑÏõåÏ£ºÏãúÍ∏∏!", poem: "ÏÉàÌï¥Í∞Ä Î∞ùÏïÑÏôîÎÑ§,\nÎØøÏùåÏùÄ Íµ≥Í±¥ÌïòÎÑ§.\nÍ±¥Í∞ïÍ≥º ÌñâÎ≥µÏù¥,\nÎãπÏã†Í≥º Ìï®ÍªòÌïòÍ∏∏." }
            },
            ja: {
                tts: 'ja-JP',
                ui: { title: "Á•ùÁ¶è„ÅÆ2026", desc: "ÂêçÂâç:", ph: "ÂêçÂâç...", start: "ÈñãÂßã", next: "Ê¨°„Å∏", share: "ÂÖ±Êúâ", download: "üì∏ ‰øùÂ≠ò", hint: "Èñã„Åë„Çã!", days: "Êó•", hours: "ÊôÇ", mins: "ÂàÜ", secs: "Áßí", err_char: "„Ç®„É©„Éº", err_rep: "Áπ∞„ÇäËøî„Åó", conf_q: "{name}„Åï„Çì?", yes: "„ÅØ„ÅÑ", no: "„ÅÑ„ÅÑ„Åà" },
                coming: { greet: "{name}„Åï„Çì„ÄÅ„Ç¢„ÉÉ„É©„Éº„ÅÆÁ•ùÁ¶è„Åå„ÅÇ„Çä„Åæ„Åô„Çà„ÅÜ„Å´ÔºÅ", poem: "„Ç¢„ÉÉ„É©„Éº„ÅåÂ∞é„ÅçÁµ¶„ÅÜ„ÄÅ\nÊÇ©„Åø„ÅØÊ∂à„ÅàÂéª„Çä„Å¨„ÄÇ\nÊù•„Çã„Åπ„ÅçÊñ∞Âπ¥„Å´„ÄÅ\nÂπ∏„ÅÇ„Çå„Å®Á•à„Çã„ÄÇ" },
                arrived: { greet: "{name}„Åï„Çì„ÄÅÂπ≥ÂÆâ„ÅåÊ∫Ä„Åü„Åï„Çå„Åæ„Åô„Çà„ÅÜ„Å´ÔºÅ", poem: "Êñ∞Âπ¥„ÅåÊù•„Åü„Çä„Å¶„ÄÅ\n‰ø°‰ª∞„ÅØÊ∑±„Åæ„Çã„ÄÇ\nÂÅ•„ÇÑ„Åã„ÅßÊ∏Ö„Çâ„Åã„Å´„ÄÅ\nÂñú„Å≥Ê∫¢„Çå„ÇãÊó•„ÄÖ„ÄÇ" }
            },
            es: {
                tts: 'es-ES',
                ui: { title: "Bendito 2026", desc: "Nombre:", ph: "Nombre...", start: "Iniciar", next: "Siguiente", share: "Compartir", download: "üì∏ Bajar", hint: "¬°Abrir!", days: "d", hours: "h", mins: "m", secs: "s", err_char: "Error.", err_rep: "Repetici√≥n.", conf_q: "¬øEres {name}?", yes: "S√≠", no: "No" },
                coming: { greet: "Querido {name}, ¬°que Al√° te conceda √©xito!", poem: "Que Allah gu√≠e tu caminar,\nY te aleje de todo mal.\nEn este a√±o que va a empezar,\nMucha paz te va a regalar." },
                arrived: { greet: "Querido {name}, ¬°que Al√° llene tu vida de paz!", poem: "El a√±o nuevo ya lleg√≥,\nLa fe en el alma floreci√≥.\nSalud y paz en tu hogar,\nBendiciones sin cesar." }
            },
            mn: {
                tts: 'mn-MN', // –ö”©–ø —Ç–µ–ª–µ—Ñ–æ–Ω–¥–∞ –∂–æ“õ, –±—ñ—Ä–∞“õ “õ–æ—Å—ã–ø “õ–æ–π–¥—ã“õ
                ui: { title: "–ò–≤—ç—ç–ª—Ç 2026", desc: "–ù—ç—Ä:", ph: "–ù—ç—Ä...", start: "–≠—Ö–ª—ç—Ö", next: "–î–∞—Ä–∞–∞—Ö", share: "–•—É–≤–∞–∞–ª—Ü–∞—Ö", download: "üì∏ –¢–∞—Ç–∞—Ö", hint: "–ù—ç—ç—Ö!", days: "”©–¥”©—Ä", hours: "—Ü–∞–≥", mins: "–º–∏–Ω", secs: "—Å–µ–∫", err_char: "–ê–ª–¥–∞–∞.", err_rep: "–î–∞–≤—Ç–∞–ª—Ç.", conf_q: "{name} –º”©–Ω “Ø“Ø?", yes: "–¢–∏–π–º", no: "“Æ–≥“Ø–π" },
                coming: { greet: "–≠—Ä—Ö—ç–º {name}, –ê–ª–ª–∞—Ö —Ç–∞–Ω–¥ –∏–≤—ç—ç–ª—ç—ç —Ö–∞–π—Ä–ª–∞–≥!", poem: "–ê–ª–ª–∞—Ö —Ç–∞–Ω—ã–≥ –∏–≤—ç—ç–≥,\n–ó–æ–≤–ª–æ–Ω –±“Ø—Ö–Ω–∏–π–≥ –º–∞—Ä—Ç—É—É–ª–∞–≥.\n–ò—Ä–∂ –±—É–π —à–∏–Ω—ç –∂–∏–ª–¥,\n–ê–∑ –∂–∞—Ä–≥–∞–ª –¥“Ø“Ø—Ä—ç–Ω –±–∞–π–≥." },
                arrived: { greet: "–≠—Ä—Ö—ç–º {name}, –ê–ª–ª–∞—Ö —Ç–∞–Ω—ã –∞–º—å–¥—Ä–∞–ª—ã–≥ –∞–º–∞—Ä –∞–º–≥–∞–ª–∞–Ω –±–æ–ª–≥–æ–≥!", poem: "–®–∏–Ω—ç –æ–Ω –∏—Ä–ª—ç—ç,\n–°“Ø—Å—ç–≥ –±–∏—à—Ä—ç–ª –Ω—ç–º—ç–≥–¥–ª—ç—ç.\n–≠—Ä“Ø“Ø–ª —ç–Ω—Ö, —Å–∞–π–Ω —Å–∞–π—Ö–∞–Ω,\n“Æ“Ø—Ä–¥ –º”©–Ω—Ö –±–∞–π–≥." }
            }
        };

        const destinations = [
            { name: "Astana üá∞üáø", coords: [51.16, 71.47], lang: "kk" },
            { name: "Moscow üá∑üá∫", coords: [55.75, 37.61], lang: "ru" },
            { name: "London üá¨üáß", coords: [51.50, -0.12], lang: "en" },
            { name: "Paris üá´üá∑", coords: [48.85, 2.35], lang: "fr" },
            { name: "Berlin üá©üá™", coords: [52.52, 13.40], lang: "de" },
            { name: "Mecca üá∏üá¶", coords: [21.38, 39.85], lang: "ar" },
            { name: "Beijing üá®üá≥", coords: [39.90, 116.40], lang: "zh" },
            { name: "Seoul üá∞üá∑", coords: [37.56, 126.97], lang: "ko" },
            { name: "Tokyo üáØüáµ", coords: [35.67, 139.65], lang: "ja" },
            { name: "Madrid üá™üá∏", coords: [40.41, -3.70], lang: "es" },
            { name: "Ulaanbaatar üá≤üá≥", coords: [47.91, 106.91], lang: "mn" }
        ];

        let map, planeMarker, flightLine;
        let currentDestIndex = 0;
        let userName = "–î–æ—Å—ã–º";
        let isVoiceEnabled = true;
        const synth = window.speechSynthesis;

        window.onload = () => {
            initMap();
            setInterval(updateCountdown, 1000);
            updateCountdown(); 
            const urlParams = new URLSearchParams(window.location.search);
            const sharedName = urlParams.get('name');
            if (sharedName) {
                document.getElementById('confirmNameBlock').classList.remove('hidden');
                document.getElementById('inputNameBlock').classList.add('hidden');
                document.getElementById('detectedName').textContent = sharedName;
                userName = sharedName;
            }
            changeLanguage();
        };

        function initMap() {
            map = L.map('map', { zoomControl: false }).setView([40, 0], 3);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '', subdomains: 'abcd', maxZoom: 19 }).addTo(map);
            const planeIcon = L.divIcon({ html: '<div style="font-size: 40px;">‚úàÔ∏è</div>', className: 'plane-icon', iconSize: [40, 40], iconAnchor: [20, 20] });
            planeMarker = L.marker([51.16, 71.47], {icon: planeIcon}).addTo(map);
        }

        function validateName(name) {
            if (/[0-9!@#$%^&*()_+={}\[\]|\\:;"'<>,.?/~`]/.test(name)) return "char";
            if (/(.)\1{3,}/.test(name)) return "repeat";
            return "ok";
        }

        function startJourney() {
            const inputVal = document.getElementById('nameInput').value.trim();
            const lang = document.getElementById('uiLangSelect').value;
            const t = translations[lang].ui;
            const errorDiv = document.getElementById('errorMsg');

            if (!inputVal) { userName = "–î–æ—Å—ã–º"; } 
            else {
                const status = validateName(inputVal);
                if (status === "char") { errorDiv.textContent = t.err_char; errorDiv.style.display = 'block'; return; }
                else if (status === "repeat") { errorDiv.textContent = t.err_rep; errorDiv.style.display = 'block'; return; }
                userName = inputVal;
            }
            errorDiv.style.display = 'none';
            proceedToJourney();
        }

        function confirmNameYes() { proceedToJourney(); }
        function confirmNameNo() {
            document.getElementById('confirmNameBlock').classList.add('hidden');
            document.getElementById('inputNameBlock').classList.remove('hidden');
            document.getElementById('nameInput').value = "";
        }

        function proceedToJourney() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('journeyScreen').classList.remove('hidden');
            const lang = document.getElementById('uiLangSelect').value;
            const cityIndex = destinations.findIndex(d => d.lang === lang);
            if(cityIndex !== -1) currentDestIndex = cityIndex;
            flyToCity(destinations[currentDestIndex]);
        }

        function flyToCity(city) {
            const oldLatLng = planeMarker.getLatLng();
            const newLatLng = city.coords;
            map.flyTo(newLatLng, 5, { duration: 2.5 });
            planeMarker.setLatLng(newLatLng);
            if (flightLine) map.removeLayer(flightLine);
            flightLine = L.polyline([oldLatLng, newLatLng], {color: '#FFD700', weight: 3, opacity: 0.8, dashArray: '10, 10'}).addTo(map);
        }

        function updateCountdown() {
            const now = new Date().getTime();
            const distance = targetDate - now;
            const lang = document.getElementById('uiLangSelect').value;
            const t = translations[lang].ui;
            if (distance < 0) {
                document.getElementById('loginCountdown').textContent = "üéâ 2026!";
                document.getElementById('mainCountdown').textContent = "üéâ 2026!";
            } else {
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                const timeStr = `‚è≥ ${days}${t.days} ${hours}${t.hours} ${minutes}${t.mins} ${seconds}${t.secs}`;
                document.getElementById('loginCountdown').textContent = timeStr;
                document.getElementById('mainCountdown').textContent = timeStr;
            }
        }

        function changeLanguage() {
            const lang = document.getElementById('uiLangSelect').value;
            const t = translations[lang].ui;
            document.querySelector('#loginScreen h1').textContent = t.title;
            document.getElementById('appDesc').textContent = t.desc;
            document.getElementById('nameInput').placeholder = t.ph;
            document.getElementById('btnStart').textContent = t.start;
            document.getElementById('chestHint').textContent = t.hint;
            document.getElementById('confirmQuestion').innerHTML = t.conf_q.replace("{name}", `<b style="color:#FFD700">${userName}</b>`);
            document.getElementById('btnYes').textContent = t.yes;
            document.getElementById('btnNo').textContent = t.no;
            if (!document.getElementById('contentWrapper').classList.contains('hidden')) updateCardContent();
        }

        // --- –î–´–ë–´–°–¢–ê–ü –û“ö–£ (TTS) ---
        function toggleVoice() {
            isVoiceEnabled = !isVoiceEnabled;
            const btn = document.getElementById('voiceBtn');
            if (isVoiceEnabled) {
                btn.textContent = "üó£Ô∏è"; // Speaker On
                btn.classList.add('speaking');
                // –ï–≥–µ—Ä —Å–∞–Ω–¥—ã“õ –∞—à—ã“õ –±–æ–ª—Å–∞, –±—ñ—Ä–¥–µ–Ω –æ“õ—ã–ø –±–∞—Å—Ç–∞—É
                if (!document.getElementById('contentWrapper').classList.contains('hidden')) {
                    const text = document.getElementById('poemBox').textContent;
                    const lang = document.getElementById('uiLangSelect').value;
                    speakText(text, lang);
                }
            } else {
                btn.textContent = "üîá"; // Mute
                btn.classList.remove('speaking');
                synth.cancel();
            }
        }

        function speakText(text, langCode) {
            if (!isVoiceEnabled) return;
            synth.cancel(); // –ê–ª–¥—ã“£“ì—ã—Å—ã–Ω —Ç–æ“õ—Ç–∞—Ç—É
            
            const utterance = new SpeechSynthesisUtterance(text);
            // –¢—ñ–ª –∫–æ–¥—ã–Ω –∞–ª—É (–º—ã—Å–∞–ª—ã 'en-US')
            utterance.lang = translations[langCode].tts || 'en-US'; 
            utterance.rate = 0.9; // –°”ô–ª –±–∞—è—É –æ“õ—É
            utterance.pitch = 1.1; // –°”ô–ª –∂—ñ“£—ñ—à–∫–µ –¥–∞—É—ã—Å
            
            synth.speak(utterance);
        }

        function openChest() {
            confetti({ particleCount: 100, spread: 70, origin: { x: 0.75, y: 0.6 }, shapes: ['circle'], colors: ['#FFD700', '#FF0000', '#00FF00'] });
            const scalar = 3;
            const emojis = confetti.shapeFromText({ text: 'üê¥', scalar });
            const flowers = confetti.shapeFromText({ text: 'üå∏', scalar });
            confetti({ particleCount: 15, scalar: 3, spread: 100, origin: { x: 0.75, y: 0.7 }, shapes: [emojis, flowers] });
            
            document.getElementById('chestWrapper').style.display = 'none';
            document.getElementById('contentWrapper').classList.remove('hidden');
            document.getElementById('controlButtons').classList.remove('hidden');
            
            // –ë–∞—Ç—ã—Ä–º–∞–Ω—ã –±–µ–ª—Å–µ–Ω–¥—ñ –µ—Ç—É (–≤–∏–∑—É–∞–ª–¥—ã)
            if (isVoiceEnabled) {
                document.getElementById('voiceBtn').textContent = "üó£Ô∏è";
                document.getElementById('voiceBtn').classList.add('speaking');
            }
            
            updateCardContent();
        }

        function updateCardContent() {
            const city = destinations[currentDestIndex];
            const langCode = city.lang;
            document.getElementById('uiLangSelect').value = langCode;
            const t = translations[langCode];
            const now = new Date().getTime();
            const data = (now >= targetDate) ? t.arrived : t.coming;
            
            const poemText = data.poem;
            const greetingText = data.greet.replace("{name}", userName);

            document.getElementById('cityName').textContent = city.name;
            document.getElementById('greetingMsg').innerHTML = greetingText.replace(userName, `<b style="color:#FFD700">${userName}</b>`);
            document.getElementById('poemBox').textContent = poemText;
            document.getElementById('btnNext').textContent = t.ui.next;
            document.getElementById('btnShare').textContent = t.ui.share;
            document.getElementById('btnDownload').textContent = t.ui.download;

            // ”®–ª–µ“£–¥—ñ –æ“õ—É
            speakText(poemText, langCode);
        }

        function nextCity() {
            currentDestIndex = (currentDestIndex + 1) % destinations.length;
            flyToCity(destinations[currentDestIndex]);
            updateCardContent();
        }

        function shareGreeting() {
            const url = window.location.href.split('?')[0] + "?name=" + encodeURIComponent(userName);
            if (navigator.share) { navigator.share({ title: '2026 Wish', url: url }); } 
            else { navigator.clipboard.writeText(url); alert("Copied!"); }
        }

        function downloadCard() {
            const captureElement = document.getElementById('captureArea');
            captureElement.style.background = "linear-gradient(135deg, #0f2027, #2c5364)"; 
            html2canvas(captureElement, { backgroundColor: null, scale: 2 }).then(canvas => {
                captureElement.style.background = ""; 
                const link = document.createElement('a');
                link.download = 'NewYear2026_Greeting.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }
    </script>
</body>
</html>

