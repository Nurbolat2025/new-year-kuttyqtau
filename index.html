<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–µ—Ä–µ–∫–µ–ª—ñ –ñ–∞“£–∞ –ñ—ã–ª 2026</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1565C0">
    <link rel="icon" type="image/png" href="icon-192.png">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            margin: 0; padding: 0;
            min-height: 100vh;
            color: white;
            text-align: center;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        /* --- –ö–ê–†–¢–ê –§–û–ù --- */
        #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
        .overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 20, 50, 0.6); /* –ö”©–∫—à—ñ–ª –∫“Ø“£–≥—ñ—Ä—Ç —Ñ–æ–Ω */
            z-index: 1; pointer-events: none; 
        }

        /* --- –ñ–û“í–ê–†“í–´ –ú”ò–ó–Ü–† --- */
        .top-controls {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            display: flex; gap: 10px;
        }
        .icon-btn {
            background: rgba(255, 255, 255, 0.2); color: white;
            border: 1px solid rgba(255,255,255,0.3); border-radius: 50%;
            width: 45px; height: 45px; font-size: 20px; cursor: pointer;
            backdrop-filter: blur(5px);
        }
        .lang-select {
            background: rgba(255, 255, 255, 0.9); border-radius: 20px; padding: 5px 15px;
            font-weight: bold; border: none; cursor: pointer;
        }

        /* --- –û–†–¢–ê“¢“í–´ –ë–õ–û–ö --- */
        .card {
            position: relative; z-index: 100;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            padding: 25px; border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            width: 90%; max-width: 450px;
            transition: all 0.5s ease;
        }

        h1 { color: #FFD700; text-shadow: 0 2px 10px rgba(0,0,0,0.5); font-size: 1.8rem; margin: 10px 0; }

        /* –¢–∞–π–º–µ—Ä */
        .countdown-box {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.4);
            color: #84ffff;
            padding: 10px; border-radius: 10px;
            margin: 10px 0;
            font-size: 1.2rem; border: 1px solid #84ffff;
        }

        /* –°–∞–Ω–¥—ã“õ (Chest) */
        .chest-container {
            font-size: 80px; cursor: pointer;
            margin: 20px 0;
            transition: transform 0.2s;
            animation: bounce 2s infinite;
        }
        .chest-container:hover { transform: scale(1.1); }
        .chest-hint { font-size: 0.9rem; color: #ccc; margin-top: -10px; margin-bottom: 20px;}

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* –ú”ô—Ç—ñ–Ω–¥–µ—Ä */
        .city-name { font-size: 2rem; color: #fff; text-shadow: 2px 2px 4px #000; }
        .greeting-text { font-size: 1.1rem; line-height: 1.5; color: #fff; margin: 15px 0; }
        
        .poem-box {
            background: rgba(0, 50, 0, 0.3); /* –ñ–∞—Å—ã–ª —Ä–µ“£–∫ (–ò—Å–ª–∞–º) */
            padding: 15px; border-radius: 15px;
            margin: 15px 0; border-left: 5px solid #FFD700;
            font-style: italic; white-space: pre-line;
            color: #fffde7; font-size: 1rem;
        }

        input { width: 90%; padding: 12px; margin: 10px 0; border-radius: 10px; border: none; text-align: center; font-size: 16px; }
        .main-btn {
            width: 100%; padding: 14px; margin: 5px 0;
            border-radius: 12px; border: none; font-size: 16px; font-weight: bold;
            background: linear-gradient(135deg, #FFD700 0%, #FFA000 100%);
            color: #000; cursor: pointer;
        }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="map"></div>
    <div class="overlay"></div>

    <audio id="bgMusic" loop preload="auto">
        <source src="https://cdn.pixabay.com/download/audio/2022/10/25/audio_1f23348651.mp3" type="audio/mp3">
    </audio>

    <div class="top-controls">
        <button id="musicBtn" class="icon-btn" onclick="toggleMusic()">üîá</button>
        <select id="uiLangSelect" class="lang-select" onchange="changeLanguage()">
            <option value="kk">üá∞üáø “ö–ê–ó</option>
            <option value="ru">üá∑üá∫ –†–£–°</option>
            <option value="en">üá∫üá∏ ENG</option>
            <option value="tr">üáπüá∑ TUR</option>
            <option value="ar">üá¶üá™ ARA</option>
        </select>
    </div>

    <div id="loginScreen" class="card">
        <h1>‚ú® 2026 –ñ—ã–ª</h1>
        <div id="loginCountdown" class="countdown-box">...</div>
        <p id="appDesc">–ê–¥–∞–ª –Ω–∏–µ—Ç–ø–µ–Ω “õ“±—Ç—Ç—ã“õ—Ç–∞—É –∂–æ–ª–¥–∞“£—ã–∑!</p>
        <input type="text" id="nameInput" placeholder="–ï—Å—ñ–º—ñ“£—ñ–∑...">
        <button onclick="startJourney()" class="main-btn" id="btnStart">–ê—à—É ü§≤</button>
    </div>

    <div id="journeyScreen" class="card hidden">
        
        <div id="mainCountdown" class="countdown-box"></div>

        <div id="chestWrapper" onclick="openChest()">
            <div class="chest-container">üéÅ</div>
            <div class="chest-hint">–°—ã–π–ª—ã“õ—Ç—ã –∞—à—É “Ø—à—ñ–Ω –±–∞—Å—ã“£—ã–∑!</div>
        </div>

        <div id="contentWrapper" class="hidden">
            <h2 id="cityName" class="city-name">Astana</h2>
            <div id="greetingMsg" class="greeting-text">...</div>
            <div id="poemBox" class="poem-box">...</div>
            
            <button onclick="nextCity()" class="main-btn" id="btnNext">–ö–µ–ª–µ—Å—ñ –µ–ª ‚úàÔ∏è</button>
            <button onclick="shareGreeting()" class="main-btn" style="background:#fff; color:#000" id="btnShare">–ë”©–ª—ñ—Å—É üîó</button>
        </div>
    </div>

    <script>
        // --- –î–ï–†–ï–ö–¢–ï–† –ë–ê–ó–ê–°–´ (–®–ê–†–ò“í–ê–¢“ö–ê –°–ê–ô) ---
        // 2026 –ñ—ã–ª - –ñ—ã–ª“õ—ã –∂—ã–ª—ã (Horse) üê¥
        const targetDate = new Date("January 1, 2026 00:00:00").getTime();

        const translations = {
            kk: {
                ui: { title: "–ë–µ—Ä–µ–∫–µ–ª—ñ 2026 –ñ—ã–ª", desc: "–ê—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑:", ph: "–ê—Ç—ã“£—ã–∑...", start: "–ë–∞—Å—Ç–∞—É ü§≤", next: "–ö–µ–ª–µ—Å—ñ –µ–ª ‚úàÔ∏è", share: "–ë”©–ª—ñ—Å—É üîó", hint: "–°–∞–Ω–¥—ã“õ—Ç—ã –±–∞—Å—ã“£—ã–∑! üéÅ", days: "–∫“Ø–Ω", hours: "—Å–∞“ì", mins: "–º–∏–Ω", secs: "—Å–µ–∫" },
                // –ö–µ–ª–µ –∂–∞—Ç“õ–∞–Ω –∂—ã–ª (Before)
                coming: {
                    greet: "“ö“±—Ä–º–µ—Ç—Ç—ñ {name}, –∫–µ–ª–µ –∂–∞—Ç“õ–∞–Ω –ñ–∞“£–∞ –∂—ã–ª–¥–∞ –ê–ª–ª–∞ –¢–∞“ì–∞–ª–∞ –µ–∫—ñ –¥“Ø–Ω–∏–µ–Ω—ñ“£ –∂–∞“õ—Å—ã–ª—ã“ì—ã–Ω –Ω”ô—Å—ñ–ø –µ—Ç—Å—ñ–Ω! –ï–ª—ñ–º—ñ–∑ —Ç—ã–Ω—ã—à, –∂“±—Ä—Ç—ã–º—ã–∑ –∞–º–∞–Ω –±–æ–ª—Å—ã–Ω.",
                    poem: "–ê–ª–ª–∞ “õ–æ–ª–¥–∞–ø ”ô—Ä —ñ—Å—ñ“£–¥—ñ –æ“£ “õ—ã–ª—Å—ã–Ω,\n–†–∏–∑—ã“õ-–Ω–µ—Å—ñ–±–µ“£ –∞–¥–∞–ª—ã–Ω–∞–Ω –º–æ–ª –±–æ–ª—Å—ã–Ω.\n–ö–µ–ª–µ –∂–∞—Ç“õ–∞–Ω –∂—ã–ª–¥–∞ –º—ã–Ω–∞—É –∂–∞“£–∞—Ä—ã–ø,\n–ò–º–∞–Ω—ã“£—ã–∑ –Ω“±—Ä“ì–∞ —Ç–æ–ª—ã –∑–æ—Ä –±–æ–ª—Å—ã–Ω!"
                },
                // –ö–µ–ª—ñ–ø –∂–µ—Ç–∫–µ–Ω –∂—ã–ª (After)
                arrived: {
                    greet: "“ö“±—Ä–º–µ—Ç—Ç—ñ {name}, –∫–µ–ª—ñ–ø –∂–µ—Ç–∫–µ–Ω –ñ–∞“£–∞ –∂—ã–ª–¥–∞ –ê–ª–ª–∞ –¢–∞“ì–∞–ª–∞ ”ô—Ä–±—ñ—Ä –∫“Ø–Ω—ñ“£—ñ–∑–≥–µ –±–µ—Ä–µ–∫–µ –±–µ—Ä—Å—ñ–Ω! –û—Ç–±–∞—Å—ã“£—ã–∑“ì–∞ –∞–º–∞–Ω–¥—ã“õ —Ç—ñ–ª–µ–π–º—ñ–Ω.",
                    poem: "–ñ–∞“£–∞ –∂—ã–ª–¥–∞ –∂–∞“õ—Å—ã–ª—ã“õ—Ç–∞—Ä –∫”©–ø –±–æ–ª—Å—ã–Ω,\n–£–∞–π—ã–º-“õ–∞–π“ì—ã –µ—à“õ–∞—à–∞–Ω–¥–∞ –∂–æ“õ –±–æ–ª—Å—ã–Ω.\n–ê–ª–ª–∞ –±–µ—Ä–≥–µ–Ω “ì“±–º—ã—Ä—ã“£—ã–∑ –º”ô–Ω–¥—ñ –±–æ–ø,\n–î–∞—Å—Ç–∞—Ä—Ö–∞–Ω—ã“£ –∞–¥–∞–ª –∞—Å“õ–∞ —Ç–æ“õ –±–æ–ª—Å—ã–Ω!"
                }
            },
            ru: {
                ui: { title: "–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω—ã–π 2026", desc: "–í–≤–µ–¥–∏—Ç–µ –∏–º—è:", ph: "–í–∞—à–µ –∏–º—è...", start: "–û—Ç–∫—Ä—ã—Ç—å ü§≤", next: "–°–ª–µ–¥. —Å—Ç—Ä–∞–Ω–∞ ‚úàÔ∏è", share: "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è üîó", hint: "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—É–Ω–¥—É–∫! üéÅ", days: "–¥–Ω", hours: "—á", mins: "–º–∏–Ω", secs: "—Å–µ–∫" },
                coming: {
                    greet: "–£–≤–∞–∂–∞–µ–º—ã–π(–∞—è) {name}, –≤ –Ω–∞—Å—Ç—É–ø–∞—é—â–µ–º –≥–æ–¥—É –ø—É—Å—Ç—å –í—Å–µ–≤—ã—à–Ω–∏–π –¥–∞—Ä—É–µ—Ç –≤–∞–º –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ –∏ —É–∫—Ä–µ–ø–∏—Ç –≤–∞—à—É –≤–µ—Ä—É!",
                    poem: "–ü—É—Å—Ç—å –ê–ª–ª–∞—Ö —Ö—Ä–∞–Ω–∏—Ç –æ—Ç –±–µ–¥,\n–î–∞—Ä–∏—Ç –º—É–¥—Ä–æ—Å—Ç—å –∏ —Å–æ–≤–µ—Ç.\n–í –Ω–∞—Å—Ç—É–ø–∞—é—â–µ–º –≥–æ–¥—É,\n–û—Ç–≤–æ–¥–∏—Ç –≥–æ—Ä–µ –∏ –±–µ–¥—É."
                },
                arrived: {
                    greet: "–£–≤–∞–∂–∞–µ–º—ã–π(–∞—è) {name}, –≤ –Ω–∞—Å—Ç—É–ø–∏–≤—à–µ–º –≥–æ–¥—É –ø—É—Å—Ç—å –í—Å–µ–≤—ã—à–Ω–∏–π –Ω–∞–ø–æ–ª–Ω–∏—Ç –≤–∞—à –¥–æ–º –±–∞—Ä–∞–∫–∞—Ç–æ–º (–±–ª–∞–≥–æ–¥–∞—Ç—å—é)!",
                    poem: "–ì–æ–¥ –ø—Ä–∏—à–µ–ª, —Ö–≤–∞–ª–∞ –¢–≤–æ—Ä—Ü—É,\n–°—á–∞—Å—Ç—å–µ –ø—É—Å—Ç—å –ø—Ä–∏–¥–µ—Ç –∫ –ª–∏—Ü—É.\n–ú–∏—Ä, –ø–æ–∫–æ–π –∏ –±–ª–∞–≥–æ–¥–∞—Ç—å,\n–ë—É–¥—É—Ç –¥–æ–º –≤–∞—à –Ω–∞–ø–æ–ª–Ω—è—Ç—å."
                }
            },
            en: {
                ui: { title: "Blessed 2026", desc: "Enter name:", ph: "Name...", start: "Start ü§≤", next: "Next ‚úàÔ∏è", share: "Share üîó", hint: "Tap the chest! üéÅ", days: "d", hours: "h", mins: "m", secs: "s" },
                coming: {
                    greet: "Dear {name}, in this coming year, may the Almighty grant you halal sustenance and success in all good deeds!",
                    poem: "May Allah guide you day by day,\nKeep all troubles far away.\nIn the coming year so new,\nMay His blessings be with you."
                },
                arrived: {
                    greet: "Dear {name}, in this new year, may the Almighty fill your life with peace, faith, and prosperity!",
                    poem: "New year is here, bright and clear,\nMay faith in heart be ever near.\nGoodness, health, and halal wealth,\nJoy and peace and spiritual health."
                }
            },
            tr: {
                ui: { title: "Bereketli 2026", desc: "Adƒ±nƒ±z:", ph: "Adƒ±nƒ±z...", start: "Ba≈üla ü§≤", next: "Sonraki ‚úàÔ∏è", share: "Payla≈ü üîó", hint: "Sandƒ±ƒüa tƒ±kla! üéÅ", days: "g√ºn", hours: "sa", mins: "dk", secs: "sn" },
                coming: {
                    greet: "Sevgili {name}, yakla≈üan yeni yƒ±lda Allah size hayƒ±rlƒ± rƒ±zƒ±klar ve iman dolu bir √∂m√ºr nasip etsin!",
                    poem: "Rabbim yolunu a√ßƒ±k etsin,\nHer t√ºrl√º dertten seni korusun.\nYeni yƒ±lda t√ºm dualarƒ±n,\nHayƒ±rlƒ±sƒ±yla kabul olsun."
                },
                arrived: {
                    greet: "Sevgili {name}, yeni yƒ±lda Allah hanenize bereket, kalbinize huzur versin!",
                    poem: "Yeni yƒ±l geldi ho≈ü geldi,\nG√∂nl√ºne iman dolsun ebedi.\nRabbimden dilerim saadet,\nHayatƒ±n olsun hep selamet."
                }
            },
            ar: {
                ui: { title: "ÿπÿßŸÖ ŸÖÿ®ÿßÿ±ŸÉ 2026", desc: "ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ:", ph: "ÿßŸÑÿßÿ≥ŸÖ...", start: "ÿßÿ®ÿØÿ£ ü§≤", next: "ÿßŸÑÿ™ÿßŸÑŸä ‚úàÔ∏è", share: "ŸÖÿ¥ÿßÿ±ŸÉÿ© üîó", hint: "ÿßÿ∂ÿ∫ÿ∑ ÿßŸÑÿµŸÜÿØŸàŸÇ! üéÅ", days: "ŸäŸàŸÖ", hours: "ÿ≥ÿßÿπÿ©", mins: "ÿØ", secs: "ÿ´" },
                coming: {
                    greet: "ÿπÿ≤Ÿäÿ≤Ÿä {name}ÿå ŸÅŸä ÿßŸÑÿπÿßŸÖ ÿßŸÑŸÇÿßÿØŸÖÿå ÿ£ÿ≥ÿ£ŸÑ ÿßŸÑŸÑŸá ÿ£ŸÜ Ÿäÿ±ÿ≤ŸÇŸÉ ÿßŸÑÿ±ÿ≤ŸÇ ÿßŸÑÿ≠ŸÑÿßŸÑ ŸàŸäÿ®ÿßÿ±ŸÉ ŸÅŸä ÿπŸÖÿ±ŸÉ!",
                    poem: "Ÿäÿß ÿ±ÿ® ÿ®ÿßÿ±ŸÉ ŸÅŸä ÿßŸÑÿπÿßŸÖ ÿßŸÑÿ¨ÿØŸäÿØÿå\nŸàÿßÿ¨ÿπŸÑ ÿ≠Ÿäÿßÿ© {name} ŸÅŸä ÿπŸäÿØ.\nÿ®ÿßŸÑÿ•ŸäŸÖÿßŸÜ ŸàÿßŸÑÿ™ŸÇŸàŸâ ÿ™ÿ≤ŸäÿØÿå\nŸàÿ±ÿ∂ÿß ÿßŸÑÿ±ÿ≠ŸÖŸÜ ŸáŸà ÿßŸÑŸÖÿ≤ŸäÿØ."
                },
                arrived: {
                    greet: "ÿπÿ≤Ÿäÿ≤Ÿä {name}ÿå ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑÿπÿßŸÖ ÿßŸÑÿ¨ÿØŸäÿØÿå ÿ£ÿ≥ÿ£ŸÑ ÿßŸÑŸÑŸá ÿ£ŸÜ ŸäŸÖŸÑÿ£ ÿ≠Ÿäÿßÿ™ŸÉ ÿ®ÿßŸÑŸÜŸàÿ± ŸàÿßŸÑÿ®ÿ±ŸÉÿ©!",
                    poem: "ÿπÿßŸÖ ÿ¨ÿØŸäÿØ ÿ£ŸÇÿ®ŸÑ ÿπŸÑŸäŸÜÿßÿå\nŸÜÿ≥ÿ£ŸÑ ÿßŸÑŸÑŸá ÿßŸÑŸÑÿ∑ŸÅ ŸÅŸäŸÜÿß.\nÿßÿ±ÿ≤ŸÇŸÜÿß Ÿäÿß ÿ±ÿ® ÿßŸÑÿ¨ŸÜÿßŸÜÿå\nŸàÿßÿ≠ŸÅÿ∏ŸÜÿß ŸÖŸÜ ŸÉŸÑ ÿ¥Ÿäÿ∑ÿßŸÜ."
                }
            }
        };

        const destinations = [
            { name: "Astana üá∞üáø", tz: "Asia/Almaty", lang: "kk", coords: [51.16, 71.47] },
            { name: "Mecca üá∏üá¶", tz: "Asia/Riyadh", lang: "ar", coords: [21.3891, 39.8579] }, // –ú–µ–∫–∫–µ “õ–æ—Å—ã–ª–¥—ã
            { name: "Istanbul üáπüá∑", tz: "Europe/Istanbul", lang: "tr", coords: [41.0082, 28.9784] },
            { name: "Kuala Lumpur üá≤üáæ", tz: "Asia/Kuala_Lumpur", lang: "en", coords: [3.1390, 101.6869] },
            { name: "Tashkent üá∫üáø", tz: "Asia/Tashkent", lang: "ru", coords: [41.2995, 69.2401] },
            { name: "London üá¨üáß", tz: "Europe/London", lang: "en", coords: [51.5074, -0.1278] }
        ];

        // --- –õ–û–ì–ò–ö–ê ---
        let map, planeMarker;
        let currentDestIndex = 0;
        let userName = "";
        let isMusicPlaying = false;
        const audio = document.getElementById('bgMusic');

        window.onload = () => {
            initMap();
            setInterval(updateCountdown, 1000);
            updateCountdown(); // –±—ñ—Ä–¥–µ–Ω –∫”©—Ä—Å–µ—Ç—É
            changeLanguage();
        };

        function initMap() {
            map = L.map('map', { zoomControl: false }).setView([51.16, 71.47], 4);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '', subdomains: 'abcd', maxZoom: 19
            }).addTo(map);
            
            const planeIcon = L.divIcon({
                html: '<div style="font-size: 30px; transform: rotate(-45deg);">‚úàÔ∏è</div>',
                className: 'plane-marker', iconSize: [30, 30]
            });
            planeMarker = L.marker([51.16, 71.47], {icon: planeIcon}).addTo(map);
        }

        // –¢–ê–ô–ú–ï–†
        function updateCountdown() {
            const now = new Date().getTime();
            const distance = targetDate - now;
            const lang = document.getElementById('uiLangSelect').value;
            const t = translations[lang].ui;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            let timeString = "";
            if (distance < 0) {
                // –ñ—ã–ª –∫–µ–ª–¥—ñ
                timeString = ""; 
                document.getElementById('loginCountdown').style.display = 'none';
                document.getElementById('mainCountdown').style.display = 'none';
            } else {
                // –ñ—ã–ª –∫–µ–ª–º–µ–¥—ñ
                timeString = `‚è≥ ${days}${t.days} ${hours}${t.hours} ${minutes}${t.mins} ${seconds}${t.secs}`;
                document.getElementById('loginCountdown').textContent = timeString;
                document.getElementById('mainCountdown').textContent = timeString;
            }
        }

        function changeLanguage() {
            const lang = document.getElementById('uiLangSelect').value;
            const t = translations[lang].ui;
            document.getElementById('btnStart').textContent = t.start;
            document.getElementById('nameInput').placeholder = t.ph;
            document.querySelector('.chest-hint').textContent = t.hint;
            // –ï–≥–µ—Ä —ñ—à—ñ–Ω–¥–µ –±–æ–ª—Å–∞“õ, –º”ô—Ç—ñ–Ω–¥—ñ –¥–µ –∂–∞“£–∞—Ä—Ç—É
            if(!document.getElementById('journeyScreen').classList.contains('hidden')){
               updateCardContent(); 
            }
        }

        function toggleMusic() {
            if (isMusicPlaying) {
                audio.pause(); isMusicPlaying = false; document.getElementById('musicBtn').textContent = "üîá";
            } else {
                audio.play(); isMusicPlaying = true; document.getElementById('musicBtn').textContent = "üéµ";
            }
        }

        function startJourney() {
            userName = document.getElementById('nameInput').value.trim() || "–î–æ—Å—ã–º";
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('journeyScreen').classList.remove('hidden');
            if(!isMusicPlaying) toggleMusic();
            
            // –¢—ñ–ª–¥—ñ —Å”ô–π–∫–µ—Å—Ç–µ–Ω–¥—ñ—Ä—É
            const lang = document.getElementById('uiLangSelect').value;
            const cityIndex = destinations.findIndex(d => d.lang === lang);
            if(cityIndex !== -1) currentDestIndex = cityIndex;
            
            // –ö–∞—Ä—Ç–∞–Ω—ã –¥–∞–π—ã–Ω–¥–∞—É, –±—ñ—Ä–∞“õ ”ô–ª—ñ —Å–∞–Ω–¥—ã“õ –∞—à—ã–ª–º–∞–¥—ã
            const city = destinations[currentDestIndex];
            map.flyTo(city.coords, 5, { duration: 2 });
            planeMarker.setLatLng(city.coords);
        }

        // –°–ê–ù–î–´“ö–¢–´ –ê–®–£ (–≠–ú–û–î–ó–ò –ê–¢–´–õ–£ + –ú”ò–¢–Ü–ù –®–´“í–£)
        function openChest() {
            // –≠–º–æ–¥–∑–∏ –∞—Ç—É: –ñ—ã–ª“õ—ã (2026), –ì“Ø–ª, –ê—é
            const duration = 2000;
            const end = Date.now() + duration;

            // –°–∞–ª—é—Ç –ª–æ–≥–∏–∫–∞—Å—ã
            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    shapes: ['circle'], 
                    scalar: 2, // “Æ–ª–∫–µ–Ω—ñ—Ä–µ–∫
                    colors: ['#FFD700', '#FF0000']
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: ['#00FF00', '#0000FF']
                });

                // –ê—Ä–Ω–∞–π—ã —ç–º–æ–¥–∑–∏–ª–µ—Ä (–ñ—ã–ª“õ—ã, –ì“Ø–ª)
                confetti({
                    particleCount: 2,
                    angle: 90,
                    spread: 100,
                    origin: { y: 0.7 },
                    shapes: ['circle'], 
                    scalar: 3,
                    shapeOptions: {
                        render: (ctx) => {
                            ctx.font = '30px Arial';
                            ctx.fillText(['üê¥','üêé','üå∏','üß∏','‚ú®'][Math.floor(Math.random()*5)], 0, 0);
                        }
                    }
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());

            // –°–∞–Ω–¥—ã“õ—Ç—ã –∂–∞—Å—ã—Ä—É, –º”ô—Ç—ñ–Ω–¥—ñ –∫”©—Ä—Å–µ—Ç—É
            document.getElementById('chestWrapper').style.display = 'none';
            document.getElementById('contentWrapper').classList.remove('hidden');
            
            updateCardContent();
        }

        function updateCardContent() {
            const city = destinations[currentDestIndex];
            const now = new Date().getTime();
            const isNewYearArrived = now >= targetDate;

            // –¢—ñ–ª–¥—ñ –∞–Ω—ã“õ—Ç–∞—É
            // 1. –ï–≥–µ—Ä —Å–æ–ª “õ–∞–ª–∞–Ω—ã“£ —Ç—ñ–ª—ñ –±–∞–∑–∞–¥–∞ –±–æ–ª—Å–∞, —Å–æ–Ω—ã –∞–ª–∞–º—ã–∑
            // 2. –ë–æ–ª–º–∞—Å–∞, –∞“ì—ã–ª—à—ã–Ω—à–∞
            let langCode = translations[city.lang] ? city.lang : 'en';
            
            // Dropdown-–¥—ã —Å–∏–Ω—Ö—Ä–æ–Ω–¥–∞—É
            document.getElementById('uiLangSelect').value = langCode;

            // –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∞–ª—É
            const t = translations[langCode];
            const data = isNewYearArrived ? t.arrived : t.coming; // –£–∞“õ—ã—Ç“õ–∞ “õ–∞—Ä–∞–π —Ç–∞“£–¥–∞—É

            document.getElementById('cityName').textContent = city.name;
            document.getElementById('greetingMsg').innerHTML = data.greet.replace("{name}", `<b style="color:#FFD700">${userName}</b>`);
            document.getElementById('poemBox').textContent = data.poem;

            document.getElementById('btnNext').textContent = t.ui.next;
            document.getElementById('btnShare').textContent = t.ui.share;
        }

        function nextCity() {
            currentDestIndex = (currentDestIndex + 1) % destinations.length;
            const city = destinations[currentDestIndex];
            
            // “∞—à—É
            map.flyTo(city.coords, 5, { duration: 2.5 });
            planeMarker.setLatLng(city.coords);

            updateCardContent();
        }

        function shareGreeting() {
            const url = window.location.href.split('?')[0] + "?name=" + encodeURIComponent(userName);
            if (navigator.share) {
                navigator.share({ title: 'New Year Wish', url: url });
            } else {
                navigator.clipboard.writeText(url);
                alert("–°—ñ–ª—Ç–µ–º–µ –∫”©—à—ñ—Ä—ñ–ª–¥—ñ / Link copied");
            }
        }
    </script>
</body>
</html>
